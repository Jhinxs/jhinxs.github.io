<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Windows BIOS MBR引导分析 - Jhin&#39;s Story</title><meta name="Description" content="Jhinxs"><meta property="og:title" content="Windows BIOS MBR引导分析" />
<meta property="og:description" content="流程概述 Windows BIOS开机引导流程概览：
 1.开机主板加电，BIOS运行 2.运行硬盘开头的MBR代码 3.MBR代码引导运行Bootmgr（也有可能引导VBR，然后VBR引导Bootmgr） 4.Bootmgr根据BCD配置，自动运行或让用户选择不同的启动项，并加载运行Winload.exe 5.Winload.exe加载ntoskrnl.exe内核模块 6.ntoskrnl.exe启动操作系统  MBR与VBR结构概览 
MBR MBR主引导记录，用于引导后续运行的代码，一般用作引导bootmgr等第二阶段的引导程序
MBR一般位于每块硬盘的最开头的512个字节，也就是一个扇区的大小，其中前446个字节为引导程序，然后是64个字节的分区表，其中每个分区项为16个字节，最后是2个字节的Magic,统一为0X55,0XAA,操作系统用此Magic确定和查找引导记录，如果没有，则无法进行引导。
其中446个字节的引导程序中：
  前162个字节为MBR可执行代码
  163-1B2这80个字节为错误信息字符串
  1B3-1BD这11字节包含2个byte 00 padding,3个字节63 7B 9A分别代表了错误信息字符串的offset，然后是4个字节的磁盘签名，然后是2个字节的padding
  磁盘签名可以通过注册表查看：reg query HKEY_LOCAL_MACHINE\SYSTEM\MountedDevices
  MBR结构 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  //主引导记录 typedef struct _MASTER_BOOT_RECORD { CHAR bootcode[446]; //实际的引导代码 	MBR_PARTITION_TABLE partitiontable[4]; //分区表 	USHORT MBRMagic; // 0x55AA }MASTER_BOOT_RECORD,*PMASTER_BOOT_RECORD; //分区表项 typedef struct _MBR_PARTITION_TABLE { BYTE ActiveStatus; //活动状态 0x80=active 0x00=noactive，表示当前分区是否为活动分区，只能有一个活动分区 	BYTE StartHead; WORD StartingSectCylinder; //起始扇区柱面 	BYTE PARTITION_SYSTEMID; //标识ID，指示当前分区的分区类型，比如常见的有：NTFS,FAT32等等 	BYTE EndHead; WORD EndingSectCylinder; DWORD RelativeSector; DWORD TotalSectors; //分区中的总扇区数 }MBR_PARTITION_TABLE,*PMBR_PARTITION_TABLE;   分析MBR代码 MBR的字节码如下图，测试环境为WIN10,21H2" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jhinxs.com/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90/" /><meta property="og:image" content="https://jhinxs.com/images/jhin.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-05T16:07:06+08:00" />
<meta property="article:modified_time" content="2022-11-05T16:07:06+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jhinxs.com/images/jhin.png"/>

<meta name="twitter:title" content="Windows BIOS MBR引导分析"/>
<meta name="twitter:description" content="流程概述 Windows BIOS开机引导流程概览：
 1.开机主板加电，BIOS运行 2.运行硬盘开头的MBR代码 3.MBR代码引导运行Bootmgr（也有可能引导VBR，然后VBR引导Bootmgr） 4.Bootmgr根据BCD配置，自动运行或让用户选择不同的启动项，并加载运行Winload.exe 5.Winload.exe加载ntoskrnl.exe内核模块 6.ntoskrnl.exe启动操作系统  MBR与VBR结构概览 
MBR MBR主引导记录，用于引导后续运行的代码，一般用作引导bootmgr等第二阶段的引导程序
MBR一般位于每块硬盘的最开头的512个字节，也就是一个扇区的大小，其中前446个字节为引导程序，然后是64个字节的分区表，其中每个分区项为16个字节，最后是2个字节的Magic,统一为0X55,0XAA,操作系统用此Magic确定和查找引导记录，如果没有，则无法进行引导。
其中446个字节的引导程序中：
  前162个字节为MBR可执行代码
  163-1B2这80个字节为错误信息字符串
  1B3-1BD这11字节包含2个byte 00 padding,3个字节63 7B 9A分别代表了错误信息字符串的offset，然后是4个字节的磁盘签名，然后是2个字节的padding
  磁盘签名可以通过注册表查看：reg query HKEY_LOCAL_MACHINE\SYSTEM\MountedDevices
  MBR结构 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  //主引导记录 typedef struct _MASTER_BOOT_RECORD { CHAR bootcode[446]; //实际的引导代码 	MBR_PARTITION_TABLE partitiontable[4]; //分区表 	USHORT MBRMagic; // 0x55AA }MASTER_BOOT_RECORD,*PMASTER_BOOT_RECORD; //分区表项 typedef struct _MBR_PARTITION_TABLE { BYTE ActiveStatus; //活动状态 0x80=active 0x00=noactive，表示当前分区是否为活动分区，只能有一个活动分区 	BYTE StartHead; WORD StartingSectCylinder; //起始扇区柱面 	BYTE PARTITION_SYSTEMID; //标识ID，指示当前分区的分区类型，比如常见的有：NTFS,FAT32等等 	BYTE EndHead; WORD EndingSectCylinder; DWORD RelativeSector; DWORD TotalSectors; //分区中的总扇区数 }MBR_PARTITION_TABLE,*PMBR_PARTITION_TABLE;   分析MBR代码 MBR的字节码如下图，测试环境为WIN10,21H2"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://jhinxs.com/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90/" /><link rel="prev" href="https://jhinxs.com/ollvm-windows%E4%B8%8B%E7%BC%96%E8%AF%91%E5%8F%8Avs%E9%9B%86%E6%88%90/" /><link rel="next" href="https://jhinxs.com/%E5%AE%89%E5%85%A8%E6%9E%B6%E6%9E%84-%E9%9B%B6%E4%BF%A1%E4%BB%BB%E5%88%9D%E8%AF%86/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Windows BIOS MBR引导分析",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/jhinxs.com\/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90\/"
        },"image": ["https:\/\/jhinxs.com\/jhin.png"],"genre": "posts","keywords": "Kernel, OS","wordcount":  4710 ,
        "url": "https:\/\/jhinxs.com\/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90\/","datePublished": "2022-11-05T16:07:06+08:00","dateModified": "2022-11-05T16:07:06+08:00","license": "jhinxs story","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/jhinxs.com\/jhin.png"},"author": {
                "@type": "Person",
                "name": "jhinxs"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jhin&#39;s Story"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Jhinxs</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/Jhinxs" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jhin&#39;s Story"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>Jhinxs</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/Jhinxs" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Windows BIOS MBR引导分析</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>jhinxs</a></span>&nbsp;<span class="post-category">included in <a href="/categories/hardwarewindows-os/"><i class="far fa-folder fa-fw"></i>Hardware,Windows OS</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-11-05">2022-11-05</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;4710 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;23 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#流程概述">流程概述</a></li>
        <li><a href="#mbr与vbr结构概览">MBR与VBR结构概览</a></li>
        <li><a href="#mbr">MBR</a>
          <ul>
            <li><a href="#mbr结构">MBR结构</a></li>
            <li><a href="#分析mbr代码">分析MBR代码</a></li>
          </ul>
        </li>
        <li><a href="#vbr">VBR</a>
          <ul>
            <li><a href="#vbr结构">VBR结构</a></li>
            <li><a href="#分析vbr代码">分析VBR代码</a></li>
          </ul>
        </li>
        <li><a href="#mbrvbr-bochs-动态调试">MBR/VBR Bochs 动态调试</a></li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h3 id="流程概述">流程概述</h3>
<p>Windows BIOS开机引导流程概览：</p>
<ul>
<li>1.开机主板加电，BIOS运行</li>
<li>2.运行硬盘开头的MBR代码</li>
<li>3.MBR代码引导运行Bootmgr（也有可能引导VBR，然后VBR引导Bootmgr）</li>
<li>4.Bootmgr根据BCD配置，自动运行或让用户选择不同的启动项，并加载运行Winload.exe</li>
<li>5.Winload.exe加载ntoskrnl.exe内核模块</li>
<li>6.ntoskrnl.exe启动操作系统</li>
</ul>
<h3 id="mbr与vbr结构概览">MBR与VBR结构概览</h3>
<p><a href="/images/assets/post6/mbrvbr.png" rel=""><img src="/images/assets/post6/mbrvbr.png" width="100%"/></a></p>
<h3 id="mbr">MBR</h3>
<p>MBR主引导记录，用于引导后续运行的代码，一般用作引导bootmgr等第二阶段的引导程序</p>
<p>MBR一般位于每块硬盘的最开头的512个字节，也就是一个扇区的大小，其中前446个字节为引导程序，然后是64个字节的分区表，其中每个分区项为16个字节，最后是2个字节的Magic,统一为0X55,0XAA,操作系统用此Magic确定和查找引导记录，如果没有，则无法进行引导。</p>
<p>其中446个字节的引导程序中：</p>
<ul>
<li>
<p>前162个字节为MBR可执行代码</p>
</li>
<li>
<p>163-1B2这80个字节为错误信息字符串</p>
</li>
<li>
<p>1B3-1BD这11字节包含2个byte 00 padding,3个字节63 7B 9A分别代表了错误信息字符串的offset，然后是4个字节的磁盘签名，然后是2个字节的padding</p>
</li>
<li>
<p>磁盘签名可以通过注册表查看：reg query HKEY_LOCAL_MACHINE\SYSTEM\MountedDevices</p>
</li>
</ul>
<h4 id="mbr结构">MBR结构</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">//主引导记录
</span><span class="c1"></span><span class="k">typedef</span> <span class="k">struct</span>  <span class="nc">_MASTER_BOOT_RECORD</span>
<span class="p">{</span>
	<span class="n">CHAR</span> <span class="n">bootcode</span><span class="p">[</span><span class="mi">446</span><span class="p">];</span>   <span class="c1">//实际的引导代码
</span><span class="c1"></span>	<span class="n">MBR_PARTITION_TABLE</span> <span class="n">partitiontable</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>   <span class="c1">//分区表
</span><span class="c1"></span>	<span class="n">USHORT</span> <span class="n">MBRMagic</span><span class="p">;</span>      <span class="c1">// 0x55AA 
</span><span class="c1"></span><span class="p">}</span><span class="n">MASTER_BOOT_RECORD</span><span class="p">,</span><span class="o">*</span><span class="n">PMASTER_BOOT_RECORD</span><span class="p">;</span>

<span class="c1">//分区表项
</span><span class="c1"></span><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">_MBR_PARTITION_TABLE</span> 
<span class="p">{</span>
	<span class="n">BYTE</span> <span class="n">ActiveStatus</span><span class="p">;</span>         <span class="c1">//活动状态 0x80=active 0x00=noactive，表示当前分区是否为活动分区，只能有一个活动分区
</span><span class="c1"></span>	<span class="n">BYTE</span> <span class="n">StartHead</span><span class="p">;</span>
	<span class="n">WORD</span> <span class="n">StartingSectCylinder</span><span class="p">;</span> <span class="c1">//起始扇区柱面
</span><span class="c1"></span>	<span class="n">BYTE</span> <span class="n">PARTITION_SYSTEMID</span><span class="p">;</span>   <span class="c1">//标识ID，指示当前分区的分区类型，比如常见的有：NTFS,FAT32等等
</span><span class="c1"></span>	<span class="n">BYTE</span> <span class="n">EndHead</span><span class="p">;</span>
	<span class="n">WORD</span> <span class="n">EndingSectCylinder</span><span class="p">;</span>
	<span class="n">DWORD</span> <span class="n">RelativeSector</span><span class="p">;</span>
	<span class="n">DWORD</span> <span class="n">TotalSectors</span><span class="p">;</span>        <span class="c1">//分区中的总扇区数
</span><span class="c1"></span><span class="p">}</span><span class="n">MBR_PARTITION_TABLE</span><span class="p">,</span><span class="o">*</span><span class="n">PMBR_PARTITION_TABLE</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="分析mbr代码">分析MBR代码</h4>
<p>MBR的字节码如下图，测试环境为WIN10,21H2<br>
<a href="/images/assets/post6/mbrhex.png" rel=""><img src="/images/assets/post6/mbrhex.png" width="100%"/></a>
IDA静态分析：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="nl">seg000:</span><span class="err">7</span><span class="nf">C00</span>                         <span class="no">seg000</span>          <span class="no">segment</span> <span class="no">byte</span> <span class="no">public</span> <span class="err">&#39;</span><span class="no">CODE</span><span class="err">&#39;</span> <span class="no">use16</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C00</span>                                         <span class="no">assume</span> <span class="no">cs</span><span class="p">:</span><span class="no">seg000</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C00</span>                                         <span class="c">;org 7C00h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C00</span>                                         <span class="no">assume</span> <span class="no">es</span><span class="p">:</span><span class="no">nothing</span><span class="p">,</span> <span class="no">ss</span><span class="p">:</span><span class="no">nothing</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">nothing</span><span class="p">,</span> <span class="no">fs</span><span class="p">:</span><span class="no">nothing</span><span class="p">,</span> <span class="no">gs</span><span class="p">:</span><span class="no">nothing</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C00</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C00</span>                         <span class="no">loc_7C00</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7D2A↓J
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C00</span> <span class="mi">33</span> <span class="no">C0</span>                                   <span class="no">xor</span>     <span class="no">ax</span><span class="p">,</span> <span class="no">ax</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C02</span> <span class="mi">8</span><span class="no">E</span> <span class="no">D0</span>                                   <span class="no">mov</span>     <span class="no">ss</span><span class="p">,</span> <span class="no">ax</span>          <span class="c">; 段地址为0
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C04</span> <span class="no">BC</span> <span class="mi">00</span> <span class="mi">7</span><span class="no">C</span>                                <span class="no">mov</span>     <span class="no">sp</span><span class="p">,</span> <span class="mi">7</span><span class="no">C00h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C07</span> <span class="mi">8</span><span class="no">E</span> <span class="no">C0</span>                                   <span class="no">mov</span>     <span class="no">es</span><span class="p">,</span> <span class="no">ax</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C09</span> <span class="mi">8</span><span class="no">E</span> <span class="no">D8</span>                                   <span class="no">mov</span>     <span class="no">ds</span><span class="p">,</span> <span class="no">ax</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C0B</span> <span class="no">BE</span> <span class="mi">00</span> <span class="mi">7</span><span class="no">C</span>                                <span class="no">mov</span>     <span class="no">si</span><span class="p">,</span> <span class="mi">7</span><span class="no">C00h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C0E</span> <span class="no">BF</span> <span class="mi">00</span> <span class="mi">06</span>                                <span class="no">mov</span>     <span class="no">di</span><span class="p">,</span> <span class="mi">600</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C11</span> <span class="no">B9</span> <span class="mi">00</span> <span class="mi">02</span>                                <span class="no">mov</span>     <span class="no">cx</span><span class="p">,</span> <span class="mi">200</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C14</span> <span class="no">FC</span>                                      <span class="no">cld</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C15</span> <span class="no">F3</span> <span class="no">A4</span>                                   <span class="no">rep</span> <span class="no">movsb</span>               <span class="c">; 从ds:si 7C00h拷贝0x200个字节到 es:di 600h处；
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C15</span>                                                                 <span class="c">; 7C00h地址刚好是我们的MBR代码起始地址，大小为0x200,
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C15</span>                                                                 <span class="c">; 也就是说这段代码用于备份我们的MBR代码到600h处
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C17</span> <span class="mi">50</span>                                      <span class="no">push</span>    <span class="no">ax</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C18</span> <span class="mi">68</span> <span class="mi">1</span><span class="no">C</span> <span class="mi">06</span>                                <span class="no">push</span>    <span class="mi">61</span><span class="no">Ch</span>            <span class="c">; cs:ip = 00:61Ch;
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C18</span>                                                                 <span class="c">; retf 处理器先从栈中弹出一个字到IP，再弹出一个字到CS;
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C18</span>                                                                 <span class="c">; 跳转到61ch处执行；之前把MBR代码拷贝到了600h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C1B</span> <span class="no">CB</span>                                      <span class="no">retf</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C1C</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C1C</span> <span class="no">FB</span>                                      <span class="no">sti</span>                     <span class="c">; 代码接着从这运行
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C1D</span> <span class="no">B9</span> <span class="mi">04</span> <span class="mi">00</span>                                <span class="no">mov</span>     <span class="no">cx</span><span class="p">,</span> <span class="mi">4</span>           <span class="c">; 分区表内一共四个分区项
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C20</span> <span class="no">BD</span> <span class="no">BE</span> <span class="mi">07</span>                                <span class="no">mov</span>     <span class="no">bp</span><span class="p">,</span> <span class="mi">7</span><span class="no">BEh</span>        <span class="c">; 7BE = 600+1BE BP为第一个分区项
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C23</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C23</span>                         <span class="no">loc_7C23</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7C30↓j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C23</span> <span class="mi">80</span> <span class="mi">7</span><span class="no">E</span> <span class="mi">00</span> <span class="mi">00</span>                             <span class="no">cmp</span>     <span class="no">byte</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span> <span class="c">; 比较分区表结构体中的活动标志位，用来查找活动分区
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C27</span> <span class="mi">7</span><span class="no">C</span> <span class="mi">0</span><span class="no">B</span>                                   <span class="no">jl</span>      <span class="no">short</span> <span class="no">loc_7C34</span>  <span class="c">; 有符号数比较，小于0跳转
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C29</span> <span class="mi">0</span><span class="no">F</span> <span class="mi">85</span> <span class="mi">0</span><span class="no">E</span> <span class="mi">01</span>                             <span class="no">jnz</span>     <span class="no">loc_7D3B</span>        <span class="c">; 跳转到错误处理，活动标志要么0x80要么0x00出去别的，说明出错
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C2D</span> <span class="mi">83</span> <span class="no">C5</span> <span class="mi">10</span>                                <span class="no">add</span>     <span class="no">bp</span><span class="p">,</span> <span class="mi">10</span><span class="no">h</span>         <span class="c">; bp+10h 到下一个分区表项进行查看是否为活动分区
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C30</span> <span class="no">E2</span> <span class="no">F1</span>                                   <span class="no">loop</span>    <span class="no">loc_7C23</span>        <span class="c">; 比较分区表结构体中的活动标志位，用来查找活动分区
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C32</span> <span class="no">CD</span> <span class="mi">18</span>                                   <span class="no">int</span>     <span class="mi">18</span><span class="no">h</span>             <span class="c">; TRANSFER TO ROM BASIC
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C32</span>                                                                 <span class="c">; causes transfer to ROM-based BASIC (IBM-PC)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C32</span>                                                                 <span class="c">; often reboots a compatible; often has no effect at all
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C34</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C34</span>                         <span class="no">loc_7C34</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7C27↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C34</span>                                                                 <span class="c">; seg000:7CAE↓j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C34</span> <span class="mi">88</span> <span class="mi">56</span> <span class="mi">00</span>                                <span class="no">mov</span>     <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">0</span><span class="p">],</span> <span class="no">dl</span>      <span class="c">; 磁盘驱动器号，用于AX=41H 下的INT13,例如第一块硬盘则DL=80H,由BIOS主板设定完毕
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C37</span> <span class="mi">55</span>                                      <span class="no">push</span>    <span class="no">bp</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C38</span> <span class="no">C6</span> <span class="mi">46</span> <span class="mi">11</span> <span class="mi">05</span>                             <span class="no">mov</span>     <span class="no">byte</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">11</span><span class="no">h</span><span class="p">],</span> <span class="mi">5</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C3C</span> <span class="no">C6</span> <span class="mi">46</span> <span class="mi">10</span> <span class="mi">00</span>                             <span class="no">mov</span>     <span class="no">byte</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">10</span><span class="no">h</span><span class="p">],</span> <span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C40</span> <span class="no">B4</span> <span class="mi">41</span>                                   <span class="no">mov</span>     <span class="no">ah</span><span class="p">,</span> <span class="mi">41</span><span class="no">h</span> <span class="c">; &#39;A&#39;
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C42</span> <span class="no">BB</span> <span class="no">AA</span> <span class="mi">55</span>                                <span class="no">mov</span>     <span class="no">bx</span><span class="p">,</span> <span class="mi">55</span><span class="no">AAh</span>       <span class="c">; 构造用来测试是否支持INT13扩展 所需要的参数，当AH=41的时候，
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C42</span>                                                                 <span class="c">; int13则用于检测是否支持int13扩展，
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C42</span>                                                                 <span class="c">; CF Set On Not Present, Clear If Present
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C42</span>                                                                 <span class="c">; https://en.wikipedia.org/wiki/INT_13H#INT_13h_AH=41h:_Check_Extensions_Present
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C45</span> <span class="no">CD</span> <span class="mi">13</span>                                   <span class="no">int</span>     <span class="mi">13</span><span class="no">h</span>             <span class="c">; DISK - Check for INT 13h Extensions
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C45</span>                                                                 <span class="c">; BX = 55AAh, DL = drive number
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C45</span>                                                                 <span class="c">; Return: CF set if not supported
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C45</span>                                                                 <span class="c">; AH = extensions version
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C45</span>                                                                 <span class="c">; BX = AA55h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C45</span>                                                                 <span class="c">; CX = Interface support bit map
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C47</span> <span class="mi">5</span><span class="no">D</span>                                      <span class="no">pop</span>     <span class="no">bp</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C48</span> <span class="mi">72</span> <span class="mi">0</span><span class="no">F</span>                                   <span class="no">jb</span>      <span class="no">short</span> <span class="no">loc_7C59</span>  <span class="c">; CF=1 跳转，此时表示不支持INT13扩展
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C4A</span> <span class="mi">81</span> <span class="no">FB</span> <span class="mi">55</span> <span class="no">AA</span>                             <span class="no">cmp</span>     <span class="no">bx</span><span class="p">,</span> <span class="mi">0</span><span class="no">AA55h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C4E</span> <span class="mi">75</span> <span class="mi">09</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_7C59</span>  <span class="c">; bx是否为AA55h，不是则不支持
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C50</span> <span class="no">F7</span> <span class="no">C1</span> <span class="mi">01</span> <span class="mi">00</span>                             <span class="no">test</span>    <span class="no">cx</span><span class="p">,</span> <span class="mi">1</span>           <span class="c">; cx=1 表示支持Device Access using the packet structure
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C54</span> <span class="mi">74</span> <span class="mi">03</span>                                   <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_7C59</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C56</span> <span class="no">FE</span> <span class="mi">46</span> <span class="mi">10</span>                                <span class="no">inc</span>     <span class="no">byte</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">10</span><span class="no">h</span><span class="p">]</span> <span class="c">; 到这表示支持，标志位加1
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C59</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C59</span>                         <span class="no">loc_7C59</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7C48↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C59</span>                                                                 <span class="c">; seg000:7C4E↑j ...
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C59</span> <span class="mi">66</span> <span class="mi">60</span>                                   <span class="no">pushad</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C5B</span> <span class="mi">80</span> <span class="mi">7</span><span class="no">E</span> <span class="mi">10</span> <span class="mi">00</span>                             <span class="no">cmp</span>     <span class="no">byte</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">10</span><span class="no">h</span><span class="p">],</span> <span class="mi">0</span> <span class="c">; 判断标志位，是否支持int13扩展
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C5F</span> <span class="mi">74</span> <span class="mi">26</span>                                   <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_7C87</span>  <span class="c">; 不支持跳转到标准INT13处
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C61</span> <span class="mi">66</span> <span class="mi">68</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>                       <span class="no">push</span>    <span class="no">large</span> <span class="mi">0</span>         <span class="c">; 构造Packet Structure
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C61</span>                                                                 <span class="c">; struct DiskPacket
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C61</span>                                                                 <span class="c">; {
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C61</span>                                                                 <span class="c">;     .packet_size     db 0x10 ; use_transfer_64 ? 10h : 18h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C61</span>                                                                 <span class="c">;     .reserved        db 0x00 ; always zero
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C61</span>                                                                 <span class="c">;     .block_cout      dw 0x00 ; number of sectors to read
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C61</span>                                                                 <span class="c">;     .transfer_buffer dd 0x00 ; address to load in ram
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C61</span>                                                                 <span class="c">;     .lba_value       dq 0x00 ; LBA addres value
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C61</span>                                                                 <span class="c">; }
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C67</span> <span class="mi">66</span> <span class="no">FF</span> <span class="mi">76</span> <span class="mi">08</span>                             <span class="no">push</span>    <span class="no">large</span> <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">8</span><span class="p">]</span> <span class="c">; 读取的源地址，以扇区为单位，这里是0x800扇区，也就是0x100000字节处
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C6B</span> <span class="mi">68</span> <span class="mi">00</span> <span class="mi">00</span>                                <span class="no">push</span>    <span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C6E</span> <span class="mi">68</span> <span class="mi">00</span> <span class="mi">7</span><span class="no">C</span>                                <span class="no">push</span>    <span class="mi">7</span><span class="no">C00h</span>           <span class="c">; 写入的目的地址，完成拷贝
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C71</span> <span class="mi">68</span> <span class="mi">01</span> <span class="mi">00</span>                                <span class="no">push</span>    <span class="mi">1</span>               <span class="c">; 读取一个扇区
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C74</span> <span class="mi">68</span> <span class="mi">10</span> <span class="mi">00</span>                                <span class="no">push</span>    <span class="mi">10</span><span class="no">h</span>             <span class="c">; packet 大小
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C77</span> <span class="no">B4</span> <span class="mi">42</span>                                   <span class="no">mov</span>     <span class="no">ah</span><span class="p">,</span> <span class="mi">42</span><span class="no">h</span> <span class="c">; &#39;B&#39;   ; AH=42H Extended Read Sectors From Drive
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C79</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">56</span> <span class="mi">00</span>                                <span class="no">mov</span>     <span class="no">dl</span><span class="p">,</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">0</span><span class="p">]</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C7C</span> <span class="mi">8</span><span class="no">B</span> <span class="no">F4</span>                                   <span class="no">mov</span>     <span class="no">si</span><span class="p">,</span> <span class="no">sp</span>          <span class="c">; 传入packet的地址
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C7E</span> <span class="no">CD</span> <span class="mi">13</span>                                   <span class="no">int</span>     <span class="mi">13</span><span class="no">h</span>             <span class="c">; DISK - IBM/MS Extension - EXTENDED READ (DL - drive, DS:SI - disk address packet)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C80</span> <span class="mi">9</span><span class="no">F</span>                                      <span class="no">lahf</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C81</span> <span class="mi">83</span> <span class="no">C4</span> <span class="mi">10</span>                                <span class="no">add</span>     <span class="no">sp</span><span class="p">,</span> <span class="mi">10</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C84</span> <span class="mi">9</span><span class="no">E</span>                                      <span class="no">sahf</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C85</span> <span class="no">EB</span> <span class="mi">14</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_7C9B</span>  <span class="c">; 恢复通用寄存器
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C87</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C87</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C87</span>                         <span class="no">loc_7C87</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7C5F↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C87</span> <span class="no">B8</span> <span class="mi">01</span> <span class="mi">02</span>                                <span class="no">mov</span>     <span class="no">ax</span><span class="p">,</span> <span class="mi">201</span><span class="no">h</span>        <span class="c">; AH=02 功能号为02 Read Sectors From Drive
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C87</span>                                                                 <span class="c">; AL=01 读取一个扇区 Sectors To Read Count
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C8A</span> <span class="no">BB</span> <span class="mi">00</span> <span class="mi">7</span><span class="no">C</span>                                <span class="no">mov</span>     <span class="no">bx</span><span class="p">,</span> <span class="mi">7</span><span class="no">C00h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C8D</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">56</span> <span class="mi">00</span>                                <span class="no">mov</span>     <span class="no">dl</span><span class="p">,</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">0</span><span class="p">]</span>      <span class="c">; 磁盘号
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C90</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">76</span> <span class="mi">01</span>                                <span class="no">mov</span>     <span class="no">dh</span><span class="p">,</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">1</span><span class="p">]</span>      <span class="c">; 磁头
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C93</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">4</span><span class="no">E</span> <span class="mi">02</span>                                <span class="no">mov</span>     <span class="no">cl</span><span class="p">,</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">2</span><span class="p">]</span>      <span class="c">; 扇区
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C96</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">6</span><span class="no">E</span> <span class="mi">03</span>                                <span class="no">mov</span>     <span class="no">ch</span><span class="p">,</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">3</span><span class="p">]</span>      <span class="c">; 柱面
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C99</span> <span class="no">CD</span> <span class="mi">13</span>                                   <span class="no">int</span>     <span class="mi">13</span><span class="no">h</span>             <span class="c">; DISK - READ SECTORS INTO MEMORY
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C99</span>                                                                 <span class="c">; AL = number of sectors to read, CH = track, CL = sector
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C99</span>                                                                 <span class="c">; DH = head, DL = drive, ES:BX -&gt; buffer to fill
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C99</span>                                                                 <span class="c">; Return: CF set on error, AH = status, AL = number of sectors read
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C9B</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">C9B</span>                         <span class="no">loc_7C9B</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7C85↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C9B</span> <span class="mi">66</span> <span class="mi">61</span>                                   <span class="no">popad</span>                   <span class="c">; 恢复通用寄存器
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C9D</span> <span class="mi">73</span> <span class="mi">1</span><span class="no">C</span>                                   <span class="no">jnb</span>     <span class="no">short</span> <span class="no">loc_7CBB</span>  <span class="c">; int13 读取成功 CF=0 JNB跳转
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">C9F</span> <span class="no">FE</span> <span class="mi">4</span><span class="no">E</span> <span class="mi">11</span>                                <span class="no">dec</span>     <span class="no">byte</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">11</span><span class="no">h</span><span class="p">]</span> <span class="c">; bp+11=5 一共会读取5次磁盘
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CA2</span> <span class="mi">75</span> <span class="mi">0</span><span class="no">C</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_7CB0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CA4</span> <span class="mi">80</span> <span class="mi">7</span><span class="no">E</span> <span class="mi">00</span> <span class="mi">80</span>                             <span class="no">cmp</span>     <span class="no">byte</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">0</span><span class="p">],</span> <span class="mi">80</span><span class="no">h</span> <span class="c">; 比较磁盘驱动器号是否为80h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CA8</span> <span class="mi">0</span><span class="no">F</span> <span class="mi">84</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">00</span>                             <span class="no">jz</span>      <span class="no">loc_7D36</span>        <span class="c">; 比较失败，进入打印错误的代码
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CAC</span> <span class="no">B2</span> <span class="mi">80</span>                                   <span class="no">mov</span>     <span class="no">dl</span><span class="p">,</span> <span class="mi">80</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CAE</span> <span class="no">EB</span> <span class="mi">84</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_7C34</span>  <span class="c">; 磁盘驱动器号，用于AX=41H 下的INT13,例如第一块硬盘则DL=80H,由BIOS主板设定完毕
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CB0</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CB0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CB0</span>                         <span class="no">loc_7CB0</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7CA2↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CB0</span> <span class="mi">55</span>                                      <span class="no">push</span>    <span class="no">bp</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CB1</span> <span class="mi">32</span> <span class="no">E4</span>                                   <span class="no">xor</span>     <span class="no">ah</span><span class="p">,</span> <span class="no">ah</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CB3</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">56</span> <span class="mi">00</span>                                <span class="no">mov</span>     <span class="no">dl</span><span class="p">,</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">0</span><span class="p">]</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CB6</span> <span class="no">CD</span> <span class="mi">13</span>                                   <span class="no">int</span>     <span class="mi">13</span><span class="no">h</span>             <span class="c">; DISK - RESET DISK SYSTEM
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CB6</span>                                                                 <span class="c">; DL = drive (if bit 7 is set both hard disks and floppy disks reset)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CB8</span> <span class="mi">5</span><span class="no">D</span>                                      <span class="no">pop</span>     <span class="no">bp</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CB9</span> <span class="no">EB</span> <span class="mi">9</span><span class="no">E</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_7C59</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CBB</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CBB</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CBB</span>                         <span class="no">loc_7CBB</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7C9D↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CBB</span> <span class="mi">81</span> <span class="mi">3</span><span class="no">E</span> <span class="no">FE</span> <span class="mi">7</span><span class="no">D</span> <span class="mi">55</span> <span class="no">AA</span>                       <span class="no">cmp</span>     <span class="no">ds</span><span class="p">:</span><span class="no">word_7DFE</span><span class="p">,</span> <span class="mi">0</span><span class="no">AA55h</span> <span class="c">; 再次检测是否包含0X55AA
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CC1</span> <span class="mi">75</span> <span class="mi">6</span><span class="no">E</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_7D31</span>  <span class="c">; 不包含则进入打印错误流程，CPU执行hlt指令并暂停运行
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CC3</span> <span class="no">FF</span> <span class="mi">76</span> <span class="mi">00</span>                                <span class="no">push</span>    <span class="no">word</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">bp</span><span class="err">+</span><span class="mi">0</span><span class="p">]</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CC6</span> <span class="no">E8</span> <span class="mi">8</span><span class="no">D</span> <span class="mi">00</span>                                <span class="no">call</span>    <span class="no">sub_7D56</span>        <span class="c">; 这个call里面的核心就是in al, 64h，从64H端口读1byte到al
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CC9</span> <span class="mi">75</span> <span class="mi">17</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_7CE2</span>  <span class="c">; AX=0BB00 INT 1A 时为， TCG_StatusCheck
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCB</span> <span class="no">FA</span>                                      <span class="no">cli</span>                     <span class="c">; 关闭中断
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCC</span> <span class="no">B0</span> <span class="no">D1</span>                                   <span class="no">mov</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">0</span><span class="no">D1h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CCE</span> <span class="no">E6</span> <span class="mi">64</span>                                   <span class="no">out</span>     <span class="mi">64</span><span class="no">h</span><span class="p">,</span> <span class="no">al</span>         <span class="c">; 8042 keyboard controller command register.
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCE</span>                                                                 <span class="c">; Write output port (next byte to port 60h):
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCE</span>                                                                 <span class="c">; 7:  1=keyboard data line pulled low (inhibited)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCE</span>                                                                 <span class="c">; 6:  1=keyboard clock line pulled low (inhibited)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCE</span>                                                                 <span class="c">; 5:  enables IRQ 12 interrupt on mouse IBF
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCE</span>                                                                 <span class="c">; 4:  enables IRQ 1 interrupt on keyboard IBF
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCE</span>                                                                 <span class="c">; 3:  1=mouse clock line pulled low (inhibited)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCE</span>                                                                 <span class="c">; 2:  1=mouse data line pulled low (inhibited)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCE</span>                                                                 <span class="c">; 1:  A20 gate on/off
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CCE</span>                                                                 <span class="c">; 0:  reset the PC (THIS BIT SHOULD ALWAYS BE SET TO 1)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CD0</span> <span class="no">E8</span> <span class="mi">83</span> <span class="mi">00</span>                                <span class="no">call</span>    <span class="no">sub_7D56</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CD3</span> <span class="no">B0</span> <span class="no">DF</span>                                   <span class="no">mov</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">0</span><span class="no">DFh</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CD5</span> <span class="no">E6</span> <span class="mi">60</span>                                   <span class="no">out</span>     <span class="mi">60</span><span class="no">h</span><span class="p">,</span> <span class="no">al</span>         <span class="c">; 8042 keyboard controller data register.
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CD7</span> <span class="no">E8</span> <span class="mi">7</span><span class="no">C</span> <span class="mi">00</span>                                <span class="no">call</span>    <span class="no">sub_7D56</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CDA</span> <span class="no">B0</span> <span class="no">FF</span>                                   <span class="no">mov</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFh</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CDC</span> <span class="no">E6</span> <span class="mi">64</span>                                   <span class="no">out</span>     <span class="mi">64</span><span class="no">h</span><span class="p">,</span> <span class="no">al</span>         <span class="c">; 8042 keyboard controller command register.
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CDC</span>                                                                 <span class="c">; Pulse output port.
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CDC</span>                                                                 <span class="c">; Bits 0-3 indicate ports to pulse.
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CDE</span> <span class="no">E8</span> <span class="mi">75</span> <span class="mi">00</span>                                <span class="no">call</span>    <span class="no">sub_7D56</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CE1</span> <span class="no">FB</span>                                      <span class="no">sti</span>                     <span class="c">; 开启中断
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE2</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">CE2</span>                         <span class="no">loc_7CE2</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7CC9↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE2</span> <span class="no">B8</span> <span class="mi">00</span> <span class="no">BB</span>                                <span class="no">mov</span>     <span class="no">ax</span><span class="p">,</span> <span class="mi">0</span><span class="no">BB00h</span>      <span class="c">; AX=0BB00 INT 1A 时为， TCG_StatusCheck
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE5</span> <span class="no">CD</span> <span class="mi">1</span><span class="no">A</span>                                   <span class="no">int</span>     <span class="mi">1</span><span class="no">Ah</span>             <span class="c">; Trusted Computing Group call - TCG_StatusCheck
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE5</span>                                                                 <span class="c">; Return: EAX = 0 if supported
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE5</span>                                                                 <span class="c">; EBX = 41504354h (&#39;TCPA&#39;)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE5</span>                                                                 <span class="c">; CH:CL = TCG BIOS Version
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE5</span>                                                                 <span class="c">; EDX = BIOS TCG Feature Flags
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE5</span>                                                                 <span class="c">; ESI = Pointer to Event Log
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE5</span>                                                                 <span class="c">;
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CE7</span> <span class="mi">66</span> <span class="mi">23</span> <span class="no">C0</span>                                <span class="no">and</span>     <span class="no">eax</span><span class="p">,</span> <span class="no">eax</span>        <span class="c">; TCG 状态检测结果放在eax,eax!=0则说明不支持
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CEA</span> <span class="mi">75</span> <span class="mi">3</span><span class="no">B</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_7D27</span>  <span class="c">; dx = 0x80 驱动器号
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CEC</span> <span class="mi">66</span> <span class="mi">81</span> <span class="no">FB</span> <span class="mi">54</span> <span class="mi">43</span> <span class="mi">50</span> <span class="mi">41</span>                    <span class="no">cmp</span>     <span class="no">ebx</span><span class="p">,</span> <span class="mi">41504354</span><span class="no">h</span>  <span class="c">; TCG检测通过会在EBX中放入&#34;TCPA&#34;的Hex字节码
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CF3</span> <span class="mi">75</span> <span class="mi">32</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_7D27</span>  <span class="c">; dx = 0x80 驱动器号
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CF5</span> <span class="mi">81</span> <span class="no">F9</span> <span class="mi">02</span> <span class="mi">01</span>                             <span class="no">cmp</span>     <span class="no">cx</span><span class="p">,</span> <span class="mi">102</span><span class="no">h</span>        <span class="c">; TCG检查返回后会在ECX中放入TCG BIOS Version
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CF9</span> <span class="mi">72</span> <span class="mi">2</span><span class="no">C</span>                                   <span class="no">jb</span>      <span class="no">short</span> <span class="no">loc_7D27</span>  <span class="c">; dx = 0x80 驱动器号
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">CFB</span> <span class="mi">66</span> <span class="mi">68</span> <span class="mi">07</span> <span class="no">BB</span> <span class="mi">00</span> <span class="mi">00</span>                       <span class="no">push</span>    <span class="no">large</span> <span class="mi">0</span><span class="no">BB07h</span>    <span class="c">; 又是跟TCG相关的一些东西
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D01</span> <span class="mi">66</span> <span class="mi">68</span> <span class="mi">00</span> <span class="mi">02</span> <span class="mi">00</span> <span class="mi">00</span>                       <span class="no">push</span>    <span class="no">large</span> <span class="mi">200</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D07</span> <span class="mi">66</span> <span class="mi">68</span> <span class="mi">08</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>                       <span class="no">push</span>    <span class="no">large</span> <span class="mi">8</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D0D</span> <span class="mi">66</span> <span class="mi">53</span>                                   <span class="no">push</span>    <span class="no">ebx</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D0F</span> <span class="mi">66</span> <span class="mi">53</span>                                   <span class="no">push</span>    <span class="no">ebx</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D11</span> <span class="mi">66</span> <span class="mi">55</span>                                   <span class="no">push</span>    <span class="no">ebp</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D13</span> <span class="mi">66</span> <span class="mi">68</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>                       <span class="no">push</span>    <span class="no">large</span> <span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D19</span> <span class="mi">66</span> <span class="mi">68</span> <span class="mi">00</span> <span class="mi">7</span><span class="no">C</span> <span class="mi">00</span> <span class="mi">00</span>                       <span class="no">push</span>    <span class="no">large</span> <span class="mi">7</span><span class="no">C00h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D1F</span> <span class="mi">66</span> <span class="mi">61</span>                                   <span class="no">popad</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D21</span> <span class="mi">68</span> <span class="mi">00</span> <span class="mi">00</span>                                <span class="no">push</span>    <span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D24</span> <span class="mi">07</span>                                      <span class="no">pop</span>     <span class="no">es</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D25</span> <span class="no">CD</span> <span class="mi">1</span><span class="no">A</span>                                   <span class="no">int</span>     <span class="mi">1</span><span class="no">Ah</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D27</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D27</span>                         <span class="no">loc_7D27</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7CEA↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D27</span>                                                                 <span class="c">; seg000:7CF3↑j ...
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D27</span> <span class="mi">5</span><span class="no">A</span>                                      <span class="no">pop</span>     <span class="no">dx</span>              <span class="c">; dx = 0x80 驱动器号
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D28</span> <span class="mi">32</span> <span class="no">F6</span>                                   <span class="no">xor</span>     <span class="no">dh</span><span class="p">,</span> <span class="no">dh</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D2A</span> <span class="no">EA</span> <span class="mi">00</span> <span class="mi">7</span><span class="no">C</span> <span class="mi">00</span> <span class="mi">00</span>                          <span class="no">jmp</span>     <span class="no">far</span> <span class="no">ptr</span> <span class="no">loc_7C00</span> <span class="c">; 7C00经过之前的拷贝已经变为了VBR的代码，现在开始转入执行VBR
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D2F</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D2F</span> <span class="no">CD</span> <span class="mi">18</span>                                   <span class="no">int</span>     <span class="mi">18</span><span class="no">h</span>             <span class="c">; TRANSFER TO ROM BASIC
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D2F</span>                                                                 <span class="c">; causes transfer to ROM-based BASIC (IBM-PC)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D2F</span>                                                                 <span class="c">; often reboots a compatible; often has no effect at all
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D31</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D31</span>                         <span class="no">loc_7D31</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7CC1↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D31</span> <span class="no">A0</span> <span class="no">B7</span> <span class="mi">07</span>                                <span class="no">mov</span>     <span class="no">al</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="mi">7</span><span class="no">B7h</span>     <span class="c">;7B7内容为9A，也是就获取700+9A处的字符串
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D34</span> <span class="no">EB</span> <span class="mi">08</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_7D3E</span>  <span class="c">; 这些都是打印错误信息
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D36</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D36</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D36</span>                         <span class="no">loc_7D36</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7CA8↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D36</span> <span class="no">A0</span> <span class="no">B6</span> <span class="mi">07</span>                                <span class="no">mov</span>     <span class="no">al</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="mi">7</span><span class="no">B6h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D39</span> <span class="no">EB</span> <span class="mi">03</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_7D3E</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D3B</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D3B</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D3B</span>                         <span class="no">loc_7D3B</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7C29↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D3B</span> <span class="no">A0</span> <span class="no">B5</span> <span class="mi">07</span>                                <span class="no">mov</span>     <span class="no">al</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="mi">7</span><span class="no">B5h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D3E</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D3E</span>                         <span class="no">loc_7D3E</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7D34↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D3E</span>                                                                 <span class="c">; seg000:7D39↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D3E</span> <span class="mi">32</span> <span class="no">E4</span>                                   <span class="no">xor</span>     <span class="no">ah</span><span class="p">,</span> <span class="no">ah</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D40</span> <span class="mi">05</span> <span class="mi">00</span> <span class="mi">07</span>                                <span class="no">add</span>     <span class="no">ax</span><span class="p">,</span> <span class="mi">700</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D43</span> <span class="mi">8</span><span class="no">B</span> <span class="no">F0</span>                                   <span class="no">mov</span>     <span class="no">si</span><span class="p">,</span> <span class="no">ax</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D45</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D45</span>                         <span class="no">loc_7D45</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7D51↓j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D45</span> <span class="no">AC</span>                                      <span class="no">lodsb</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D46</span> <span class="mi">3</span><span class="no">C</span> <span class="mi">00</span>                                   <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D48</span> <span class="mi">74</span> <span class="mi">09</span>                                   <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_7D53</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D4A</span> <span class="no">BB</span> <span class="mi">07</span> <span class="mi">00</span>                                <span class="no">mov</span>     <span class="no">bx</span><span class="p">,</span> <span class="mi">7</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D4D</span> <span class="no">B4</span> <span class="mi">0</span><span class="no">E</span>                                   <span class="no">mov</span>     <span class="no">ah</span><span class="p">,</span> <span class="mi">0</span><span class="no">Eh</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D4F</span> <span class="no">CD</span> <span class="mi">10</span>                                   <span class="no">int</span>     <span class="mi">10</span><span class="no">h</span>             <span class="c">; - VIDEO - WRITE CHARACTER AND ADVANCE CURSOR (TTY WRITE)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D4F</span>                                                                 <span class="c">; AL = character, BH = display page (alpha modes)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D4F</span>                                                                 <span class="c">; BL = foreground color (graphics modes)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D51</span> <span class="no">EB</span> <span class="no">F2</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_7D45</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D53</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D53</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D53</span>                         <span class="no">loc_7D53</span><span class="p">:</span>                               <span class="c">; CODE XREF: seg000:7D48↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D53</span>                                                                 <span class="c">; seg000:7D54↓j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D53</span> <span class="no">F4</span>                                      <span class="no">hlt</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D54</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D54</span> <span class="no">EB</span> <span class="no">FD</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_7D53</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D56</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D56</span>                         <span class="c">; =============== S U B R O U T I N E =======================================
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D56</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D56</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D56</span>                         <span class="no">sub_7D56</span>        <span class="no">proc</span> <span class="no">near</span>               <span class="c">; CODE XREF: seg000:7CC6↑p
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D56</span>                                                                 <span class="c">; seg000:7CD0↑p ...
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D56</span> <span class="mi">2</span><span class="no">B</span> <span class="no">C9</span>                                   <span class="no">sub</span>     <span class="no">cx</span><span class="p">,</span> <span class="no">cx</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D58</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D58</span>                         <span class="no">loc_7D58</span><span class="p">:</span>                               <span class="c">; CODE XREF: sub_7D56+8↓j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span> <span class="no">E4</span> <span class="mi">64</span>                                   <span class="no">in</span>      <span class="no">al</span><span class="p">,</span> <span class="mi">64</span><span class="no">h</span>         <span class="c">; 8042 keyboard controller status register
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">; 7:  PERR    1=parity error in data received from keyboard
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">;    +----------- AT Mode ----------+------------ PS/2 Mode ------------+
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">; 6: |RxTO    receive (Rx) timeout  | TO      general timeout (Rx or Tx)|
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">; 5: |TxTO    transmit (Tx) timeout | MOBF    mouse output buffer full  |
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">;    +------------------------------+-----------------------------------+
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">; 4:  INH     0=keyboard communications inhibited
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">; 3:  A2      0=60h was the port last written to, 1=64h was last
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">; 2:  SYS     distinguishes reset types: 0=cold reboot, 1=warm reboot
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">; 1:  IBF     1=input buffer full (keyboard can&#39;t accept data)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D58</span>                                                                 <span class="c">; 0:  OBF     1=output buffer full (data from keyboard is available)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D5A</span> <span class="no">EB</span> <span class="mi">00</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">$</span><span class="err">+</span><span class="mi">2</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D5C</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D5C</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D5C</span>                         <span class="no">loc_7D5C</span><span class="p">:</span>                               <span class="c">; CODE XREF: sub_7D56+4↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D5C</span> <span class="mi">24</span> <span class="mi">02</span>                                   <span class="no">and</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">2</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D5E</span> <span class="no">E0</span> <span class="no">F8</span>                                   <span class="no">loopne</span>  <span class="no">loc_7D58</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D60</span> <span class="mi">24</span> <span class="mi">02</span>                                   <span class="no">and</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">2</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D62</span> <span class="no">C3</span>                                      <span class="no">retn</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D62</span>                         <span class="no">sub_7D56</span>        <span class="no">endp</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D62</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D62</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D63</span> <span class="mi">49</span>                                      <span class="no">db</span>  <span class="mi">49</span><span class="no">h</span> <span class="c">; I
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D64</span> <span class="mi">6</span><span class="no">E</span> <span class="mi">76</span> <span class="mi">61</span> <span class="mi">6</span><span class="no">C</span> <span class="mi">69</span> <span class="mi">64</span> <span class="mi">20</span> <span class="mi">70</span><span class="err">+</span><span class="no">aNvalidPartitio</span> <span class="no">db</span> <span class="err">&#39;</span><span class="no">nvalid</span> <span class="no">partition</span> <span class="no">table</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D7B</span> <span class="mi">45</span>                                      <span class="no">db</span>  <span class="mi">45</span><span class="no">h</span> <span class="c">; E
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D7C</span> <span class="mi">72</span> <span class="mi">72</span> <span class="mi">6</span><span class="no">F</span> <span class="mi">72</span> <span class="mi">20</span> <span class="mi">6</span><span class="no">C</span> <span class="mi">6</span><span class="no">F</span> <span class="mi">61</span><span class="err">+</span><span class="no">aRrorLoadingOpe</span> <span class="no">db</span> <span class="err">&#39;</span><span class="no">rror</span> <span class="no">loading</span> <span class="no">operating</span> <span class="no">system</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">D9A</span> <span class="mi">4</span><span class="no">D</span>                                      <span class="no">db</span>  <span class="mi">4</span><span class="no">Dh</span> <span class="c">; M
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">D9B</span> <span class="mi">69</span> <span class="mi">73</span> <span class="mi">73</span> <span class="mi">69</span> <span class="mi">6</span><span class="no">E</span> <span class="mi">67</span> <span class="mi">20</span> <span class="mi">6</span><span class="no">F</span><span class="err">+</span><span class="no">aIssingOperatin</span> <span class="no">db</span> <span class="err">&#39;</span><span class="no">issing</span> <span class="no">operating</span> <span class="no">system</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">DB3</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">63</span> <span class="mi">7</span><span class="no">B</span> <span class="mi">9</span><span class="no">A</span> <span class="mi">73</span> <span class="mi">0</span><span class="no">D</span> <span class="mi">64</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">2</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">63</span><span class="no">h</span><span class="p">,</span> <span class="mi">7</span><span class="no">Bh</span><span class="p">,</span> <span class="mi">9</span><span class="no">Ah</span><span class="p">,</span> <span class="mi">73</span><span class="no">h</span><span class="p">,</span> <span class="mi">0</span><span class="no">Dh</span><span class="p">,</span> <span class="mi">64</span><span class="no">h</span><span class="p">,</span> <span class="mi">36</span><span class="no">h</span><span class="p">,</span> <span class="mi">2</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">DB3</span> <span class="mi">36</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">80</span> <span class="mi">20</span> <span class="mi">21</span> <span class="mi">00</span> <span class="mi">07</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">80</span><span class="no">h</span><span class="p">,</span> <span class="mi">20</span><span class="no">h</span><span class="p">,</span> <span class="mi">21</span><span class="no">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="no">Fh</span><span class="p">,</span> <span class="mi">39</span><span class="no">h</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">90</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">DB3</span> <span class="mi">7</span><span class="no">F</span> <span class="mi">39</span> <span class="mi">06</span> <span class="mi">00</span> <span class="mi">08</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">7</span><span class="no">Fh</span><span class="p">,</span> <span class="mi">3</span><span class="no">Ah</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="no">FEh</span><span class="p">,</span> <span class="mi">2</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="no">FFh</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">98</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">DB3</span> <span class="mi">90</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">7</span><span class="no">F</span> <span class="mi">3</span><span class="no">A</span> <span class="mi">06</span> <span class="mi">07</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">52</span><span class="no">h</span><span class="p">,</span> <span class="mi">85</span><span class="no">h</span><span class="p">,</span> <span class="mi">0</span><span class="no">ECh</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="no">FEh</span><span class="p">,</span> <span class="mi">2</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="no">FFh</span><span class="p">),</span> <span class="mi">27</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">DB3</span> <span class="no">FE</span> <span class="no">FF</span> <span class="no">FF</span> <span class="mi">00</span> <span class="mi">98</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">52</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">0</span><span class="no">FEh</span><span class="p">,</span> <span class="mi">2</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="no">FFh</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="no">h</span><span class="p">,</span> <span class="mi">0</span><span class="no">EEh</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="no">D0h</span><span class="p">,</span> <span class="mi">11</span><span class="no">h</span><span class="p">,</span> <span class="mi">11</span><span class="no">h</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">DFE</span> <span class="mi">55</span> <span class="no">AA</span>                   <span class="no">word_7DFE</span>       <span class="no">dw</span> <span class="mi">0</span><span class="no">AA55h</span>               <span class="c">; DATA XREF: seg000:loc_7CBB↑r
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">7</span><span class="no">DFE</span>                         <span class="no">seg000</span>          <span class="no">ends</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">DFE</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">DFE</span>
<span class="nl">seg000:</span><span class="err">7</span><span class="nf">DFE</span>                                         <span class="no">end</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="vbr">VBR</h3>
<p>VBR(Volume boot record)卷引导记录：</p>
<p>由于操作系统逐渐复杂，仅仅靠MBR是无法成功引导操作系统的运行，因此实际情况中，MBR则是引导活动分区的VBR,VBR读取并执行IPL(初始程序加载器)模块代码，IPL则负责解析文件系统并加载Bootmgr模块，引导操作系统初始化。</p>
<h4 id="vbr结构">VBR结构</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">_BOOTSTRAP_CODE</span>
<span class="p">{</span>

	<span class="n">BYTE</span> <span class="n">Bootcode</span><span class="p">[</span><span class="mi">426</span><span class="p">];</span>   <span class="c1">//引导扇区代码，JMP后会跳转到这
</span><span class="c1"></span>	<span class="n">WORD</span> <span class="n">bootSignature</span><span class="p">;</span>   <span class="c1">//0x55AA
</span><span class="c1"></span>
<span class="p">}</span><span class="n">BOOTSTRAP_CODE</span><span class="p">,</span><span class="o">*</span><span class="n">PBOOTSTRAP_CODE</span><span class="p">;</span>


<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">_BIOS_PARAMETER_BLOCK</span>
<span class="p">{</span>
	<span class="n">WORD</span> <span class="n">BytesPerSector</span><span class="p">;</span>
	<span class="n">BYTE</span> <span class="n">SectorsPerCluster</span><span class="p">;</span>
	<span class="n">WORD</span> <span class="n">ReservedSectors</span><span class="p">;</span>
	<span class="n">CHAR</span> <span class="n">Reserved1</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">BYTE</span> <span class="n">MediaId</span><span class="p">;</span>
	<span class="n">CHAR</span> <span class="n">Reserved2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">WORD</span> <span class="n">SectorsPerTrack</span><span class="p">;</span>
	<span class="n">WORD</span> <span class="n">NumberOfHeader</span><span class="p">;</span>
	<span class="n">DWORD</span> <span class="n">HiddenSectors</span><span class="p">;</span>            
	<span class="n">CHAR</span> <span class="n">Reserved3</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">QWORD</span> <span class="n">TotalSectorsNumber</span><span class="p">;</span>
	<span class="n">QWORD</span> <span class="n">LogicalClusterMFT</span><span class="p">;</span>
	<span class="n">QWORD</span> <span class="n">LogicalClusterMFTMirror</span><span class="p">;</span>
	<span class="n">DWORD</span> <span class="n">ClustersPerFileRecSegment</span><span class="p">;</span>
	<span class="n">DWORD</span> <span class="n">ClustersPerIndexBlock</span><span class="p">;</span>
	<span class="n">QWORD</span> <span class="n">SerialNumber</span><span class="p">;</span>
	<span class="n">DWORD</span> <span class="n">Checksum</span><span class="p">;</span>

<span class="p">}</span><span class="n">BIOS_PARAMETER_BLOCK</span><span class="p">,</span> <span class="o">*</span> <span class="n">PBIOS_PARAMETER_BLOCK</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">_VOLUME_BOOT_RECORD</span> 
<span class="p">{</span>
	<span class="n">WORD</span> <span class="n">JMP</span><span class="p">;</span>
	<span class="n">BYTE</span> <span class="n">NOP</span><span class="p">;</span>
	<span class="n">CHAR</span> <span class="n">OEM_NAME</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>                       <span class="c1">// OEM NAME 
</span><span class="c1"></span>	<span class="n">BIOS_PARAMETER_BLOCK</span> <span class="n">BPB</span><span class="p">;</span>               <span class="c1">//BIOS参数块
</span><span class="c1"></span>	<span class="n">BOOTSTRAP_CODE</span> <span class="n">BootStrap</span><span class="p">;</span>
<span class="p">}</span><span class="n">VOLUME_BOOT_RECORD</span><span class="p">,</span><span class="o">*</span><span class="n">PVOLUME_BOOT_RECORD</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="分析vbr代码">分析VBR代码</h4>
<p>VBR代码一共占用一个扇区512个字节</p>
<ul>
<li>
<p>前两个字节为一个JMP指令，用于跳转到VBR主引导代码段</p>
</li>
<li>
<p>第三个字节 90为一个NOP</p>
</li>
<li>
<p>OEM_ID占用8个字节，这个跟磁盘格式有关NTFS基本都是4E 54 46 53 20 20 20 20，如果是FAT32等别的，值会不一样</p>
</li>
<li>
<p>然后是72个字节的BPB块</p>
</li>
<li>
<p>0x54h-0x189h 则为实际的VBR引导代码</p>
</li>
<li>
<p>然后是一些00字节padding</p>
</li>
<li>
<p>8A 01 A7 01 BF 01 这些分别是错误字符串的OFFSET，例如018a则是A disk read error&hellip;..</p>
</li>
<li>
<p>最后两个字节0x55AA
<a href="/images/assets/post6/vbrhex.png" rel=""><img src="/images/assets/post6/vbrhex.png" width="100%"/></a></p>
</li>
</ul>
<p>IDA静态分析：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="nl">seg000:</span><span class="err">0000</span>                         <span class="c">; Segment type: Pure code
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">0000</span>                         <span class="nf">seg000</span>          <span class="no">segment</span> <span class="no">byte</span> <span class="no">public</span> <span class="err">&#39;</span><span class="no">CODE</span><span class="err">&#39;</span> <span class="no">use16</span>
<span class="nl">seg000:</span><span class="err">0000</span>                                         <span class="nf">assume</span> <span class="no">cs</span><span class="p">:</span><span class="no">seg000</span>
<span class="nl">seg000:</span><span class="err">0000</span>                                         <span class="nf">assume</span> <span class="no">es</span><span class="p">:</span><span class="no">nothing</span><span class="p">,</span> <span class="no">ss</span><span class="p">:</span><span class="no">nothing</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">nothing</span><span class="p">,</span> <span class="no">fs</span><span class="p">:</span><span class="no">nothing</span><span class="p">,</span> <span class="no">gs</span><span class="p">:</span><span class="no">nothing</span>
<span class="nl">seg000:</span><span class="err">0000</span> <span class="nf">EB</span> <span class="mi">52</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_54</span>    <span class="c">; 调整ss段寄存器，关闭中断
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0000</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0002</span> <span class="mi">90</span>                                      <span class="no">db</span> <span class="mi">90</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">0003</span> <span class="err">4</span><span class="nf">E</span>                                      <span class="no">db</span>  <span class="mi">4</span><span class="no">Eh</span> <span class="c">; N
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0004</span> <span class="mi">54</span> <span class="mi">46</span> <span class="mi">53</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">00</span> <span class="no">aTfs</span>            <span class="no">db</span> <span class="err">&#39;</span><span class="no">TFS</span>    <span class="err">&#39;</span><span class="p">,</span><span class="mi">0</span>          <span class="c">; DATA XREF: seg000:00F8↓o
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0004</span>                                                                 <span class="c">; seg000:00A9↓r
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">000</span><span class="no">C</span> <span class="mi">02</span>                                      <span class="no">db</span>    <span class="mi">2</span>
<span class="nl">seg000:</span><span class="err">000</span><span class="nf">D</span> <span class="mi">08</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span><span class="err">+</span><span class="no">byte_D</span>          <span class="no">db</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="no">F8h</span><span class="p">,</span> <span class="mi">2</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="no">Fh</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFh</span><span class="p">,</span> <span class="mi">2</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nl">seg000:</span><span class="err">000</span><span class="nf">D</span> <span class="no">F8</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">3</span><span class="no">F</span> <span class="mi">00</span> <span class="no">FF</span> <span class="mi">00</span> <span class="mi">00</span><span class="err">+</span>                                        <span class="c">; DATA XREF: sub_11D+20↓r
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">000</span><span class="no">D</span> <span class="mi">08</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">80</span><span class="err">+</span>                                        <span class="c">; seg000:00AF↓w ...
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">000</span><span class="no">D</span> <span class="mi">00</span> <span class="mi">80</span> <span class="mi">00</span> <span class="no">FF</span> <span class="mi">8</span><span class="no">F</span> <span class="mi">01</span> <span class="mi">00</span> <span class="mi">00</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">80</span><span class="no">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="no">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFh</span><span class="p">,</span> <span class="mi">8</span><span class="no">Fh</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nl">seg000:</span><span class="err">000</span><span class="nf">D</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="no">AA</span> <span class="mi">10</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">0</span><span class="no">AAh</span><span class="p">,</span> <span class="mi">10</span><span class="no">h</span><span class="p">,</span> <span class="mi">6</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="no">F6h</span><span class="p">,</span> <span class="mi">3</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span>
<span class="nl">seg000:</span><span class="err">000</span><span class="nf">D</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">02</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">3</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">95</span><span class="no">h</span><span class="p">,</span> <span class="mi">0</span><span class="no">BCh</span><span class="p">,</span> <span class="mi">0</span><span class="no">B5h</span><span class="p">,</span> <span class="mi">0</span><span class="no">AAh</span><span class="p">,</span> <span class="mi">0</span><span class="no">E0h</span><span class="p">,</span> <span class="mi">0</span><span class="no">B5h</span><span class="p">,</span> <span class="mi">0</span><span class="no">AAh</span><span class="p">,</span> <span class="mi">16</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">000</span><span class="nf">D</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="no">F6</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">01</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">4</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nl">seg000:</span><span class="err">0054</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">0054</span>
<span class="nl">seg000:</span><span class="err">0054</span>                         <span class="nl">loc_54:</span>                                 <span class="c">; CODE XREF: seg000:0000↑j
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">0054</span> <span class="nf">FA</span>                                      <span class="no">cli</span>                     <span class="c">; 调整ss段寄存器，关闭中断
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0055</span> <span class="mi">33</span> <span class="no">C0</span>                                   <span class="no">xor</span>     <span class="no">ax</span><span class="p">,</span> <span class="no">ax</span>
<span class="nl">seg000:</span><span class="err">0057</span> <span class="err">8</span><span class="nf">E</span> <span class="no">D0</span>                                   <span class="no">mov</span>     <span class="no">ss</span><span class="p">,</span> <span class="no">ax</span>
<span class="nl">seg000:</span><span class="err">0059</span> <span class="nf">BC</span> <span class="mi">00</span> <span class="mi">7</span><span class="no">C</span>                                <span class="no">mov</span>     <span class="no">sp</span><span class="p">,</span> <span class="mi">7</span><span class="no">C00h</span>       <span class="c">; 跳转SP到7C00，在mbr中把VBR拷贝到了这个位置
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">005</span><span class="no">C</span> <span class="no">FB</span>                                      <span class="no">sti</span>
<span class="nl">seg000:</span><span class="err">005</span><span class="nf">D</span> <span class="mi">68</span> <span class="no">C0</span> <span class="mi">07</span>                                <span class="no">push</span>    <span class="mi">7</span><span class="no">C0h</span>
<span class="nl">seg000:</span><span class="err">0060</span> <span class="err">1</span><span class="nf">F</span>                                      <span class="no">pop</span>     <span class="no">ds</span>              <span class="c">; 调整DS段寄存器 DS=7C0H
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0061</span>                                         <span class="no">assume</span> <span class="no">ds</span><span class="p">:</span><span class="no">nothing</span>
<span class="nl">seg000:</span><span class="err">0061</span> <span class="err">1</span><span class="nf">E</span>                                      <span class="no">push</span>    <span class="no">ds</span>
<span class="nl">seg000:</span><span class="err">0062</span> <span class="err">68</span> <span class="err">66</span> <span class="err">00</span>                                <span class="nf">push</span>    <span class="mi">66</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">0065</span> <span class="nf">CB</span>                                      <span class="no">retf</span>                    <span class="c">; IP=66H CS=7C0H
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0066</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0066</span> <span class="mi">88</span> <span class="mi">16</span> <span class="mi">0</span><span class="no">E</span> <span class="mi">00</span>                             <span class="no">mov</span>     <span class="no">ds</span><span class="p">:</span><span class="mi">0</span><span class="no">Eh</span><span class="p">,</span> <span class="no">dl</span>      <span class="c">; DATA XREF: seg000:00D9↓r
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0066</span>                                                                 <span class="c">; seg000:010B↓r
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0066</span>                                                                 <span class="c">; DL=0X80H 驱动器号
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">006</span><span class="no">A</span> <span class="mi">66</span> <span class="mi">81</span> <span class="mi">3</span><span class="no">E</span> <span class="mi">03</span> <span class="mi">00</span> <span class="mi">4</span><span class="no">E</span> <span class="mi">54</span> <span class="mi">46</span><span class="err">+</span>                <span class="no">cmp</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5346544</span><span class="no">Eh</span> <span class="c">; 比较oemid是否是NTFS
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0073</span> <span class="mi">75</span> <span class="mi">15</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_8A</span>
<span class="nl">seg000:</span><span class="err">0075</span> <span class="nf">B4</span> <span class="mi">41</span>                                   <span class="no">mov</span>     <span class="no">ah</span><span class="p">,</span> <span class="mi">41</span><span class="no">h</span> <span class="c">; &#39;A&#39;
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0077</span> <span class="no">BB</span> <span class="no">AA</span> <span class="mi">55</span>                                <span class="no">mov</span>     <span class="no">bx</span><span class="p">,</span> <span class="mi">55</span><span class="no">AAh</span>       <span class="c">; 继续测试是否支持INT13扩展
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">007</span><span class="no">A</span> <span class="no">CD</span> <span class="mi">13</span>                                   <span class="no">int</span>     <span class="mi">13</span><span class="no">h</span>             <span class="c">; DISK - Check for INT 13h Extensions
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">007</span><span class="no">A</span>                                                                 <span class="c">; BX = 55AAh, DL = drive number
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">007</span><span class="no">A</span>                                                                 <span class="c">; Return: CF set if not supported
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">007</span><span class="no">A</span>                                                                 <span class="c">; AH = extensions version
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">007</span><span class="no">A</span>                                                                 <span class="c">; BX = AA55h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">007</span><span class="no">A</span>                                                                 <span class="c">; CX = Interface support bit map
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">007</span><span class="no">C</span> <span class="mi">72</span> <span class="mi">0</span><span class="no">C</span>                                   <span class="no">jb</span>      <span class="no">short</span> <span class="no">loc_8A</span>    <span class="c">; CF=1 不支持跳转打印错误信息
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">007</span><span class="no">E</span> <span class="mi">81</span> <span class="no">FB</span> <span class="mi">55</span> <span class="no">AA</span>                             <span class="no">cmp</span>     <span class="no">bx</span><span class="p">,</span> <span class="mi">0</span><span class="no">AA55h</span>
<span class="nl">seg000:</span><span class="err">0082</span> <span class="err">75</span> <span class="err">06</span>                                   <span class="nf">jnz</span>     <span class="no">short</span> <span class="no">loc_8A</span>    <span class="c">; 校验BX，不通过跳转打印错误信息
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0084</span> <span class="no">F7</span> <span class="no">C1</span> <span class="mi">01</span> <span class="mi">00</span>                             <span class="no">test</span>    <span class="no">cx</span><span class="p">,</span> <span class="mi">1</span>
<span class="nl">seg000:</span><span class="err">0088</span> <span class="err">75</span> <span class="err">03</span>                                   <span class="nf">jnz</span>     <span class="no">short</span> <span class="no">loc_8D</span>    <span class="c">; 检验CX,判断是否支持 Device Access using the packet structure，不支持继续流程并打印错误信息，支持则跳转
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">008</span><span class="no">A</span>
<span class="nl">seg000:</span><span class="err">008</span><span class="nf">A</span>                         <span class="no">loc_8A</span><span class="p">:</span>                                 <span class="c">; CODE XREF: seg000:0073↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">008</span><span class="no">A</span>                                                                 <span class="c">; seg000:007C↑j ...
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">008</span><span class="no">A</span> <span class="no">E9</span> <span class="no">DD</span> <span class="mi">00</span>                                <span class="no">jmp</span>     <span class="no">loc_16A</span>
<span class="nl">seg000:</span><span class="err">008</span><span class="nf">D</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">008</span><span class="no">D</span>
<span class="nl">seg000:</span><span class="err">008</span><span class="nf">D</span>                         <span class="no">loc_8D</span><span class="p">:</span>                                 <span class="c">; CODE XREF: seg000:0088↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">008</span><span class="no">D</span> <span class="mi">1</span><span class="no">E</span>                                      <span class="no">push</span>    <span class="no">ds</span>
<span class="nl">seg000:</span><span class="err">008</span><span class="nf">E</span> <span class="mi">83</span> <span class="no">EC</span> <span class="mi">18</span>                                <span class="no">sub</span>     <span class="no">sp</span><span class="p">,</span> <span class="mi">18</span><span class="no">h</span>         <span class="c">; 提升堆栈
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0091</span> <span class="mi">68</span> <span class="mi">1</span><span class="no">A</span> <span class="mi">00</span>                                <span class="no">push</span>    <span class="mi">1</span><span class="no">Ah</span>
<span class="nl">seg000:</span><span class="err">0094</span> <span class="nf">B4</span> <span class="mi">48</span>                                   <span class="no">mov</span>     <span class="no">ah</span><span class="p">,</span> <span class="mi">48</span><span class="no">h</span> <span class="c">; &#39;H&#39;   ; AH=48H INT13为 Extended Read Drive Parameters
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0096</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">16</span> <span class="mi">0</span><span class="no">E</span> <span class="mi">00</span>                             <span class="no">mov</span>     <span class="no">dl</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="mi">0</span><span class="no">Eh</span>      <span class="c">; DL为驱动器号0x80h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">009</span><span class="no">A</span> <span class="mi">8</span><span class="no">B</span> <span class="no">F4</span>                                   <span class="no">mov</span>     <span class="no">si</span><span class="p">,</span> <span class="no">sp</span>
<span class="nl">seg000:</span><span class="err">009</span><span class="nf">C</span> <span class="mi">16</span>                                      <span class="no">push</span>    <span class="no">ss</span>
<span class="nl">seg000:</span><span class="err">009</span><span class="nf">D</span> <span class="mi">1</span><span class="no">F</span>                                      <span class="no">pop</span>     <span class="no">ds</span>              <span class="c">; ss=ds=0
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">009</span><span class="no">E</span>                                         <span class="no">assume</span> <span class="no">ds</span><span class="p">:</span><span class="no">nothing</span>
<span class="nl">seg000:</span><span class="err">009</span><span class="nf">E</span> <span class="no">CD</span> <span class="mi">13</span>                                   <span class="no">int</span>     <span class="mi">13</span><span class="no">h</span>             <span class="c">; DISK - IBM/MS Extension - GET DRIVE PARAMETERS (DL - drive, DS:SI - buffer)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A0</span> <span class="mi">9</span><span class="no">F</span>                                      <span class="no">lahf</span>                    <span class="c">; flags register -&gt; AH
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A1</span> <span class="mi">83</span> <span class="no">C4</span> <span class="mi">18</span>                                <span class="no">add</span>     <span class="no">sp</span><span class="p">,</span> <span class="mi">18</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">A4</span> <span class="mi">9</span><span class="no">E</span>                                      <span class="no">sahf</span>                    <span class="c">; AH -&gt; flag register
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span> <span class="mi">58</span>                                      <span class="no">pop</span>     <span class="no">ax</span>              <span class="c">; INT13的结果放在DS:SI处，不同offset内容不同
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; 此时add sp,18h,说明去offset为18h的地方找数据，18h-19h两个字节存放着 磁盘一个扇区有多少数据，一般为512bytes
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; offset range    size    description
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; 00h..01h    2 bytes size of Result Buffer (set this to 1Eh)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; 02h..03h    2 bytes information flags
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; 04h..07h    4 bytes physical number of cylinders = last index + 1
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; (because index starts with 0)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; 08h..0Bh    4 bytes physical number of heads = last index + 1
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; (because index starts with 0)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; 0Ch..0Fh    4 bytes physical number of sectors per track = last index
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; (because index starts with 1)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; 10h..17h    8 bytes absolute number of sectors = last index + 1
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; (because index starts with 0)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; 18h..19h    2 bytes bytes per sector
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A5</span>                                                                 <span class="c">; 1Ah..1Dh    4 bytes optional pointer to Enhanced Disk Drive (EDD) configuration parameters which may be used for subsequent interrupt 13h Extension calls (if supported)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A6</span> <span class="mi">1</span><span class="no">F</span>                                      <span class="no">pop</span>     <span class="no">ds</span>              <span class="c">; 恢复DS
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A7</span> <span class="mi">72</span> <span class="no">E1</span>                                   <span class="no">jb</span>      <span class="no">short</span> <span class="no">loc_8A</span>    <span class="c">; int13 返回CF=1 ERROR,跳转打印错误
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">A9</span> <span class="mi">3</span><span class="no">B</span> <span class="mi">06</span> <span class="mi">0</span><span class="no">B</span> <span class="mi">00</span>                             <span class="no">cmp</span>     <span class="no">ax</span><span class="p">,</span> <span class="no">word</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">aTfs</span><span class="err">+</span><span class="mi">7</span> <span class="c">; cmp ax,word ptr [0xb],0xb的地方对应BPB结构体的BytesPerSector字段
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">AD</span> <span class="mi">75</span> <span class="no">DB</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_8A</span>    <span class="c">; 如果一个扇区不等于512bytes,跳转打印错误
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">AF</span> <span class="no">A3</span> <span class="mi">0</span><span class="no">F</span> <span class="mi">00</span>                                <span class="no">mov</span>     <span class="no">word</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">2</span><span class="p">,</span> <span class="no">ax</span> <span class="c">; mov [0000fh],512
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">B2</span> <span class="no">C1</span> <span class="mi">2</span><span class="no">E</span> <span class="mi">0</span><span class="no">F</span> <span class="mi">00</span> <span class="mi">04</span>                          <span class="no">shr</span>     <span class="no">word</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="c">; 0x200h 右移4位 0x20h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">B7</span> <span class="mi">1</span><span class="no">E</span>                                      <span class="no">push</span>    <span class="no">ds</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">B8</span> <span class="mi">5</span><span class="no">A</span>                                      <span class="no">pop</span>     <span class="no">dx</span>              <span class="c">; dx=ds=7C0H
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">B9</span> <span class="mi">33</span> <span class="no">DB</span>                                   <span class="no">xor</span>     <span class="no">bx</span><span class="p">,</span> <span class="no">bx</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">BB</span> <span class="no">B9</span> <span class="mi">00</span> <span class="mi">20</span>                                <span class="no">mov</span>     <span class="no">cx</span><span class="p">,</span> <span class="mi">2000</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">BE</span> <span class="mi">2</span><span class="no">B</span> <span class="no">C8</span>                                   <span class="no">sub</span>     <span class="no">cx</span><span class="p">,</span> <span class="no">ax</span>          <span class="c">; CX=1e00h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">C0</span> <span class="mi">66</span> <span class="no">FF</span> <span class="mi">06</span> <span class="mi">11</span> <span class="mi">00</span>                          <span class="no">inc</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">4</span> <span class="c">; [0x11] =1
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">C5</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">C5</span>                         <span class="no">loc_C5</span><span class="p">:</span>                                 <span class="c">; CODE XREF: seg000:00D4↓j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">C5</span> <span class="mi">03</span> <span class="mi">16</span> <span class="mi">0</span><span class="no">F</span> <span class="mi">00</span>                             <span class="no">add</span>     <span class="no">dx</span><span class="p">,</span> <span class="no">word</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">2</span> <span class="c">; dx=07c0h+20h=7e0h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">C5</span>                                                                 <span class="c">; 15th :dx = 9A0
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">C9</span> <span class="mi">8</span><span class="no">E</span> <span class="no">C2</span>                                   <span class="no">mov</span>     <span class="no">es</span><span class="p">,</span> <span class="no">dx</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">CB</span> <span class="no">FF</span> <span class="mi">06</span> <span class="mi">16</span> <span class="mi">00</span>                             <span class="no">inc</span>     <span class="no">word</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">9</span> <span class="c">; [0x16]+1
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">CF</span> <span class="no">E8</span> <span class="mi">4</span><span class="no">B</span> <span class="mi">00</span>                                <span class="no">call</span>    <span class="no">sub_11D</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">D2</span> <span class="mi">2</span><span class="no">B</span> <span class="no">C8</span>                                   <span class="no">sub</span>     <span class="no">cx</span><span class="p">,</span> <span class="no">ax</span>          <span class="c">; CX=1E00-200H=1C00
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D2</span>                                                                 <span class="c">; 这里CX递减15次跳出循环
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D4</span> <span class="mi">77</span> <span class="no">EF</span>                                   <span class="no">ja</span>      <span class="no">short</span> <span class="no">loc_C5</span>    <span class="c">; dx=07c0h+20h=7e0h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D4</span>                                                                 <span class="c">; 15th :dx = 9A0
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D6</span> <span class="no">B8</span> <span class="mi">00</span> <span class="no">BB</span>                                <span class="no">mov</span>     <span class="no">ax</span><span class="p">,</span> <span class="mi">0</span><span class="no">BB00h</span>      <span class="c">; TCG Status Check
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D9</span> <span class="no">CD</span> <span class="mi">1</span><span class="no">A</span>                                   <span class="no">int</span>     <span class="mi">1</span><span class="no">Ah</span>             <span class="c">; Trusted Computing Group call - TCG_StatusCheck
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D9</span>                                                                 <span class="c">; Return: EAX = 0 if supported
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D9</span>                                                                 <span class="c">; EBX = 41504354h (&#39;TCPA&#39;)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D9</span>                                                                 <span class="c">; CH:CL = TCG BIOS Version
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D9</span>                                                                 <span class="c">; EDX = BIOS TCG Feature Flags
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D9</span>                                                                 <span class="c">; ESI = Pointer to Event Log
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">D9</span>                                                                 <span class="c">;
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">DB</span> <span class="mi">66</span> <span class="mi">23</span> <span class="no">C0</span>                                <span class="no">and</span>     <span class="no">eax</span><span class="p">,</span> <span class="no">eax</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">DE</span> <span class="mi">75</span> <span class="mi">2</span><span class="no">D</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_10D</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">E0</span> <span class="mi">66</span> <span class="mi">81</span> <span class="no">FB</span> <span class="mi">54</span> <span class="mi">43</span> <span class="mi">50</span> <span class="mi">41</span>                    <span class="no">cmp</span>     <span class="no">ebx</span><span class="p">,</span> <span class="mi">41504354</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">E7</span> <span class="mi">75</span> <span class="mi">24</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_10D</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">E9</span> <span class="mi">81</span> <span class="no">F9</span> <span class="mi">02</span> <span class="mi">01</span>                             <span class="no">cmp</span>     <span class="no">cx</span><span class="p">,</span> <span class="mi">102</span><span class="no">h</span>        <span class="c">; 三次比较均为校验TCG的支持状态，不支持直接跳入下一流程
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">ED</span> <span class="mi">72</span> <span class="mi">1</span><span class="no">E</span>                                   <span class="no">jb</span>      <span class="no">short</span> <span class="no">loc_10D</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">EF</span> <span class="mi">16</span>                                      <span class="no">push</span>    <span class="no">ss</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">F0</span> <span class="mi">68</span> <span class="mi">07</span> <span class="no">BB</span>                                <span class="no">push</span>    <span class="mi">0</span><span class="no">BB07h</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">F3</span> <span class="mi">16</span>                                      <span class="no">push</span>    <span class="no">ss</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">F4</span> <span class="mi">68</span> <span class="mi">52</span> <span class="mi">11</span>                                <span class="no">push</span>    <span class="mi">1152</span><span class="no">h</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">F7</span> <span class="mi">16</span>                                      <span class="no">push</span>    <span class="no">ss</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">F8</span> <span class="mi">68</span> <span class="mi">09</span> <span class="mi">00</span>                                <span class="no">push</span>    <span class="p">(</span><span class="no">offset</span> <span class="no">aTfs</span><span class="err">+</span><span class="mi">5</span><span class="p">)</span> <span class="c">; &#34;  &#34;
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">00</span><span class="no">FB</span> <span class="mi">66</span> <span class="mi">53</span>                                   <span class="no">push</span>    <span class="no">ebx</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">FD</span> <span class="mi">66</span> <span class="mi">53</span>                                   <span class="no">push</span>    <span class="no">ebx</span>
<span class="nl">seg000:</span><span class="err">00</span><span class="nf">FF</span> <span class="mi">66</span> <span class="mi">55</span>                                   <span class="no">push</span>    <span class="no">ebp</span>
<span class="nl">seg000:</span><span class="err">0101</span> <span class="err">16</span>                                      <span class="nf">push</span>    <span class="no">ss</span>
<span class="nl">seg000:</span><span class="err">0102</span> <span class="err">16</span>                                      <span class="nf">push</span>    <span class="no">ss</span>
<span class="nl">seg000:</span><span class="err">0103</span> <span class="err">16</span>                                      <span class="nf">push</span>    <span class="no">ss</span>
<span class="nl">seg000:</span><span class="err">0104</span> <span class="err">68</span> <span class="nf">B8</span> <span class="mi">01</span>                                <span class="no">push</span>    <span class="p">(</span><span class="no">offset</span> <span class="no">aOotmgrIsCompre</span><span class="err">+</span><span class="mi">0</span><span class="no">Eh</span><span class="p">)</span> <span class="c">; &#34;ressed&#34;
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0107</span> <span class="mi">66</span> <span class="mi">61</span>                                   <span class="no">popad</span>
<span class="nl">seg000:</span><span class="err">0109</span> <span class="err">0</span><span class="nf">E</span>                                      <span class="no">push</span>    <span class="no">cs</span>
<span class="nl">seg000:</span><span class="err">010</span><span class="nf">A</span> <span class="mi">07</span>                                      <span class="no">pop</span>     <span class="no">es</span>
<span class="nl">seg000:</span><span class="err">010</span><span class="nf">B</span> <span class="no">CD</span> <span class="mi">1</span><span class="no">A</span>                                   <span class="no">int</span>     <span class="mi">1</span><span class="no">Ah</span>             <span class="c">; DL=0X80H 驱动器号
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">010</span><span class="no">D</span>
<span class="nl">seg000:</span><span class="err">010</span><span class="nf">D</span>                         <span class="no">loc_10D</span><span class="p">:</span>                                <span class="c">; CODE XREF: seg000:00DE↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">010</span><span class="no">D</span>                                                                 <span class="c">; seg000:00E7↑j ...
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">010</span><span class="no">D</span> <span class="mi">33</span> <span class="no">C0</span>                                   <span class="no">xor</span>     <span class="no">ax</span><span class="p">,</span> <span class="no">ax</span>
<span class="nl">seg000:</span><span class="err">010</span><span class="nf">F</span> <span class="no">BF</span> <span class="mi">0</span><span class="no">A</span> <span class="mi">13</span>                                <span class="no">mov</span>     <span class="no">di</span><span class="p">,</span> <span class="mi">130</span><span class="no">Ah</span>
<span class="nl">seg000:</span><span class="err">0112</span> <span class="nf">B9</span> <span class="no">F6</span> <span class="mi">0</span><span class="no">C</span>                                <span class="no">mov</span>     <span class="no">cx</span><span class="p">,</span> <span class="mi">0</span><span class="no">CF6h</span>
<span class="nl">seg000:</span><span class="err">0115</span> <span class="nf">FC</span>                                      <span class="no">cld</span>
<span class="nl">seg000:</span><span class="err">0116</span> <span class="nf">F3</span> <span class="no">AA</span>                                   <span class="no">rep</span> <span class="no">stosb</span>               <span class="c">; 将EAX的值拷贝到ES:DI的位置
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0116</span>                                                                 <span class="c">; AX=0 CX=0CF6
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0116</span>                                                                 <span class="c">; 所以这是将9A00 + 130A = AD0A 清零
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0118</span> <span class="no">E9</span> <span class="no">FE</span> <span class="mi">01</span>                                <span class="no">jmp</span>     <span class="no">near</span> <span class="no">ptr</span> <span class="mi">319</span><span class="no">h</span>   <span class="c">; 跳转到BootStrap代码运行Bootmgr loader
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">011</span><span class="no">B</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">011</span><span class="no">B</span> <span class="mi">90</span>                                      <span class="no">nop</span>
<span class="nl">seg000:</span><span class="err">011</span><span class="nf">C</span> <span class="mi">90</span>                                      <span class="no">nop</span>
<span class="nl">seg000:</span><span class="err">011</span><span class="nf">D</span>
<span class="nl">seg000:</span><span class="err">011</span><span class="nf">D</span>                         <span class="c">; =============== S U B R O U T I N E =======================================
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">011</span><span class="no">D</span>
<span class="nl">seg000:</span><span class="err">011</span><span class="nf">D</span>
<span class="nl">seg000:</span><span class="err">011</span><span class="nf">D</span>                         <span class="no">sub_11D</span>         <span class="no">proc</span> <span class="no">near</span>               <span class="c">; CODE XREF: seg000:00CF↑p
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">011</span><span class="no">D</span> <span class="mi">66</span> <span class="mi">60</span>                                   <span class="no">pushad</span>
<span class="nl">seg000:</span><span class="err">011</span><span class="nf">F</span> <span class="mi">1</span><span class="no">E</span>                                      <span class="no">push</span>    <span class="no">ds</span>
<span class="nl">seg000:</span><span class="err">0120</span> <span class="err">06</span>                                      <span class="nf">push</span>    <span class="no">es</span>
<span class="nl">seg000:</span><span class="err">0121</span>
<span class="nl">seg000:</span><span class="err">0121</span>                         <span class="nl">loc_121:</span>                                <span class="c">; CODE XREF: sub_11D+46↓j
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">0121</span> <span class="err">66</span> <span class="nf">A1</span> <span class="mi">11</span> <span class="mi">00</span>                             <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="no">dword</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">4</span> <span class="c">; eax =1
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0125</span> <span class="mi">66</span> <span class="mi">03</span> <span class="mi">06</span> <span class="mi">1</span><span class="no">C</span> <span class="mi">00</span>                          <span class="no">add</span>     <span class="no">eax</span><span class="p">,</span> <span class="no">dword</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">0</span><span class="no">Fh</span> <span class="c">; EAX=[7C11]
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0125</span>                                                                 <span class="c">; [7C11]+[7C1C]
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0125</span>                                                                 <span class="c">; [7C1C]处为BPB结构体中的HiddeSectors字段
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0125</span>                                                                 <span class="c">; 该字段指示了硬盘开始到NTFS卷引导（也就是VBR）的扇区数量
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0125</span>                                                                 <span class="c">; 此数量加1x512bytes，即为IPL代码位置
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0125</span>                                                                 <span class="c">; 1h+0x800h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">012</span><span class="no">A</span> <span class="mi">1</span><span class="no">E</span>                                      <span class="no">push</span>    <span class="no">ds</span>              <span class="c">; ds=0
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">012</span><span class="no">B</span> <span class="mi">66</span> <span class="mi">68</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>                       <span class="no">push</span>    <span class="no">large</span> <span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">0131</span> <span class="err">66</span> <span class="err">50</span>                                   <span class="nf">push</span>    <span class="no">eax</span>
<span class="nl">seg000:</span><span class="err">0133</span> <span class="err">06</span>                                      <span class="nf">push</span>    <span class="no">es</span>              <span class="c">; es=7e0h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0134</span> <span class="mi">53</span>                                      <span class="no">push</span>    <span class="no">bx</span>              <span class="c">; bx=offset
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0135</span> <span class="mi">68</span> <span class="mi">01</span> <span class="mi">00</span>                                <span class="no">push</span>    <span class="mi">1</span>               <span class="c">; copy 1 sector
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0138</span> <span class="mi">68</span> <span class="mi">10</span> <span class="mi">00</span>                                <span class="no">push</span>    <span class="mi">10</span><span class="no">h</span>             <span class="c">; Disk ACCESS Packet size SET TO 10H
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">013</span><span class="no">B</span> <span class="no">B4</span> <span class="mi">42</span>                                   <span class="no">mov</span>     <span class="no">ah</span><span class="p">,</span> <span class="mi">42</span><span class="no">h</span> <span class="c">; &#39;B&#39;
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">013</span><span class="no">D</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">16</span> <span class="mi">0</span><span class="no">E</span> <span class="mi">00</span>                             <span class="no">mov</span>     <span class="no">dl</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">1</span>
<span class="nl">seg000:</span><span class="err">0141</span> <span class="err">16</span>                                      <span class="nf">push</span>    <span class="no">ss</span>
<span class="nl">seg000:</span><span class="err">0142</span> <span class="err">1</span><span class="nf">F</span>                                      <span class="no">pop</span>     <span class="no">ds</span>              <span class="c">; ds=0
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0143</span> <span class="mi">8</span><span class="no">B</span> <span class="no">F4</span>                                   <span class="no">mov</span>     <span class="no">si</span><span class="p">,</span> <span class="no">sp</span>          <span class="c">; 此时的栈结构:
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0143</span>                                                                 <span class="c">; -----0x0 00 10H DAP SIZE 10 + Reserved 00
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0143</span>                                                                 <span class="c">; -----0X4 01 00  number of sectors to be read
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0143</span>                                                                 <span class="c">; -----0X8 00 00 E0 07 07E0:0000 transfer buffer segment:offset = 7e0h:0000h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0143</span>                                                                 <span class="c">; -----0xc 01 08 LBA地址=801h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0145</span> <span class="no">CD</span> <span class="mi">13</span>                                   <span class="no">int</span>     <span class="mi">13</span><span class="no">h</span>             <span class="c">; DISK - IBM/MS Extension - EXTENDED READ (DL - drive, DS:SI - disk address packet)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0147</span> <span class="mi">66</span> <span class="mi">59</span>                                   <span class="no">pop</span>     <span class="no">ecx</span>
<span class="nl">seg000:</span><span class="err">0149</span> <span class="err">5</span><span class="nf">B</span>                                      <span class="no">pop</span>     <span class="no">bx</span>
<span class="nl">seg000:</span><span class="err">014</span><span class="nf">A</span> <span class="mi">5</span><span class="no">A</span>                                      <span class="no">pop</span>     <span class="no">dx</span>
<span class="nl">seg000:</span><span class="err">014</span><span class="nf">B</span> <span class="mi">66</span> <span class="mi">59</span>                                   <span class="no">pop</span>     <span class="no">ecx</span>
<span class="nl">seg000:</span><span class="err">014</span><span class="nf">D</span> <span class="mi">66</span> <span class="mi">59</span>                                   <span class="no">pop</span>     <span class="no">ecx</span>
<span class="nl">seg000:</span><span class="err">014</span><span class="nf">F</span> <span class="mi">1</span><span class="no">F</span>                                      <span class="no">pop</span>     <span class="no">ds</span>
<span class="nl">seg000:</span><span class="err">0150</span> <span class="err">0</span><span class="nf">F</span> <span class="mi">82</span> <span class="mi">16</span> <span class="mi">00</span>                             <span class="no">jb</span>      <span class="no">loc_16A</span>         <span class="c">; 读取失败，跳转打印错误信息
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0154</span> <span class="mi">66</span> <span class="no">FF</span> <span class="mi">06</span> <span class="mi">11</span> <span class="mi">00</span>                          <span class="no">inc</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">4</span> <span class="c">; 1-&gt;2
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0154</span>                                                                 <span class="c">; 15th [0711]变成16
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0159</span> <span class="mi">03</span> <span class="mi">16</span> <span class="mi">0</span><span class="no">F</span> <span class="mi">00</span>                             <span class="no">add</span>     <span class="no">dx</span><span class="p">,</span> <span class="no">word</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">2</span> <span class="c">; 7e0+20h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0159</span>                                                                 <span class="c">; 15th DX变成9C0h
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">015</span><span class="no">D</span> <span class="mi">8</span><span class="no">E</span> <span class="no">C2</span>                                   <span class="no">mov</span>     <span class="no">es</span><span class="p">,</span> <span class="no">dx</span>
<span class="nl">seg000:</span><span class="err">015</span><span class="nf">F</span> <span class="no">FF</span> <span class="mi">0</span><span class="no">E</span> <span class="mi">16</span> <span class="mi">00</span>                             <span class="no">dec</span>     <span class="no">word</span> <span class="no">ptr</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_D</span><span class="err">+</span><span class="mi">9</span> <span class="c">; [7c16] = 0
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0163</span> <span class="mi">75</span> <span class="no">BC</span>                                   <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_121</span>   <span class="c">; 这里判断了标志，跳转读取下一个扇区
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0165</span> <span class="mi">07</span>                                      <span class="no">pop</span>     <span class="no">es</span>
<span class="nl">seg000:</span><span class="err">0166</span> <span class="err">1</span><span class="nf">F</span>                                      <span class="no">pop</span>     <span class="no">ds</span>
<span class="nl">seg000:</span><span class="err">0167</span> <span class="err">66</span> <span class="err">61</span>                                   <span class="nf">popad</span>
<span class="nl">seg000:</span><span class="err">0169</span> <span class="nf">C3</span>                                      <span class="no">retn</span>
<span class="nl">seg000:</span><span class="err">016</span><span class="nf">A</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">016</span><span class="no">A</span>
<span class="nl">seg000:</span><span class="err">016</span><span class="nf">A</span>                         <span class="no">loc_16A</span><span class="p">:</span>                                <span class="c">; CODE XREF: seg000:loc_8A↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">016</span><span class="no">A</span>                                                                 <span class="c">; sub_11D+33↑j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">016</span><span class="no">A</span> <span class="no">A1</span> <span class="no">F6</span> <span class="mi">01</span>                                <span class="no">mov</span>     <span class="no">ax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">word_1F6</span>
<span class="nl">seg000:</span><span class="err">016</span><span class="nf">D</span> <span class="no">E8</span> <span class="mi">09</span> <span class="mi">00</span>                                <span class="no">call</span>    <span class="no">sub_179</span>
<span class="nl">seg000:</span><span class="err">0170</span> <span class="nf">A1</span> <span class="no">FA</span> <span class="mi">01</span>                                <span class="no">mov</span>     <span class="no">ax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">word_1FA</span>
<span class="nl">seg000:</span><span class="err">0173</span> <span class="nf">E8</span> <span class="mi">03</span> <span class="mi">00</span>                                <span class="no">call</span>    <span class="no">sub_179</span>
<span class="nl">seg000:</span><span class="err">0176</span>
<span class="nl">seg000:</span><span class="err">0176</span>                         <span class="nl">loc_176:</span>                                <span class="c">; CODE XREF: seg000:0177↓j
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">0176</span> <span class="nf">F4</span>                                      <span class="no">hlt</span>
<span class="nl">seg000:</span><span class="err">0176</span>                         <span class="nf">sub_11D</span>         <span class="no">endp</span>
<span class="nl">seg000:</span><span class="err">0176</span>
<span class="nl">seg000:</span><span class="err">0177</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">0177</span> <span class="nf">EB</span> <span class="no">FD</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_176</span>
<span class="nl">seg000:</span><span class="err">0179</span>
<span class="nl">seg000:</span><span class="err">0179</span>                         <span class="c">; =============== S U B R O U T I N E =======================================
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">0179</span>
<span class="nl">seg000:</span><span class="err">0179</span>
<span class="nl">seg000:</span><span class="err">0179</span>                         <span class="nf">sub_179</span>         <span class="no">proc</span> <span class="no">near</span>               <span class="c">; CODE XREF: sub_11D+50↑p
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0179</span>                                                                 <span class="c">; sub_11D+56↑p
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0179</span> <span class="mi">8</span><span class="no">B</span> <span class="no">F0</span>                                   <span class="no">mov</span>     <span class="no">si</span><span class="p">,</span> <span class="no">ax</span>
<span class="nl">seg000:</span><span class="err">017</span><span class="nf">B</span>
<span class="nl">seg000:</span><span class="err">017</span><span class="nf">B</span>                         <span class="no">loc_17B</span><span class="p">:</span>                                <span class="c">; CODE XREF: sub_179+E↓j
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">017</span><span class="no">B</span> <span class="no">AC</span>                                      <span class="no">lodsb</span>
<span class="nl">seg000:</span><span class="err">017</span><span class="nf">C</span> <span class="mi">3</span><span class="no">C</span> <span class="mi">00</span>                                   <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">017</span><span class="nf">E</span> <span class="mi">74</span> <span class="mi">09</span>                                   <span class="no">jz</span>      <span class="no">short</span> <span class="no">locret_189</span>
<span class="nl">seg000:</span><span class="err">0180</span> <span class="nf">B4</span> <span class="mi">0</span><span class="no">E</span>                                   <span class="no">mov</span>     <span class="no">ah</span><span class="p">,</span> <span class="mi">0</span><span class="no">Eh</span>
<span class="nl">seg000:</span><span class="err">0182</span> <span class="nf">BB</span> <span class="mi">07</span> <span class="mi">00</span>                                <span class="no">mov</span>     <span class="no">bx</span><span class="p">,</span> <span class="mi">7</span>
<span class="nl">seg000:</span><span class="err">0185</span> <span class="nf">CD</span> <span class="mi">10</span>                                   <span class="no">int</span>     <span class="mi">10</span><span class="no">h</span>             <span class="c">; - VIDEO - WRITE CHARACTER AND ADVANCE CURSOR (TTY WRITE)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0185</span>                                                                 <span class="c">; AL = character, BH = display page (alpha modes)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0185</span>                                                                 <span class="c">; BL = foreground color (graphics modes)
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">0187</span> <span class="no">EB</span> <span class="no">F2</span>                                   <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_17B</span>
<span class="nl">seg000:</span><span class="err">0189</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">0189</span>
<span class="nl">seg000:</span><span class="err">0189</span>                         <span class="nl">locret_189:</span>                             <span class="c">; CODE XREF: sub_179+5↑j
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">0189</span> <span class="nf">C3</span>                                      <span class="no">retn</span>
<span class="nl">seg000:</span><span class="err">0189</span>                         <span class="nf">sub_179</span>         <span class="no">endp</span>
<span class="nl">seg000:</span><span class="err">0189</span>
<span class="nl">seg000:</span><span class="err">0189</span>                         <span class="c">; ---------------------------------------------------------------------------
</span><span class="c"></span><span class="nl">seg000:</span><span class="err">018</span><span class="nf">A</span> <span class="mi">0</span><span class="no">D</span>                                      <span class="no">db</span>  <span class="mi">0</span><span class="no">Dh</span>
<span class="nl">seg000:</span><span class="err">018</span><span class="nf">B</span> <span class="mi">0</span><span class="no">A</span>                                      <span class="no">db</span>  <span class="mi">0</span><span class="no">Ah</span>
<span class="nl">seg000:</span><span class="err">018</span><span class="nf">C</span> <span class="mi">41</span>                                      <span class="no">db</span>  <span class="mi">41</span><span class="no">h</span> <span class="c">; A
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">018</span><span class="no">D</span> <span class="mi">20</span> <span class="mi">64</span> <span class="mi">69</span> <span class="mi">73</span> <span class="mi">6</span><span class="no">B</span> <span class="mi">20</span> <span class="mi">72</span> <span class="mi">65</span><span class="err">+</span><span class="no">aDiskReadErrorO</span> <span class="no">db</span> <span class="err">&#39;</span> <span class="no">disk</span> <span class="no">read</span> <span class="no">error</span> <span class="no">occurred</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">A7</span> <span class="mi">0</span><span class="no">D</span>                                      <span class="no">db</span>  <span class="mi">0</span><span class="no">Dh</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">A8</span> <span class="mi">0</span><span class="no">A</span>                                      <span class="no">db</span>  <span class="mi">0</span><span class="no">Ah</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">A9</span> <span class="mi">42</span>                                      <span class="no">db</span>  <span class="mi">42</span><span class="no">h</span> <span class="c">; B
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">01</span><span class="no">AA</span> <span class="mi">4</span><span class="no">F</span> <span class="mi">4</span><span class="no">F</span> <span class="mi">54</span> <span class="mi">4</span><span class="no">D</span> <span class="mi">47</span> <span class="mi">52</span> <span class="mi">20</span> <span class="mi">69</span><span class="err">+</span><span class="no">aOotmgrIsCompre</span> <span class="no">db</span> <span class="err">&#39;</span><span class="no">OOTMGR</span> <span class="no">is</span> <span class="no">compressed</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">AA</span> <span class="mi">73</span> <span class="mi">20</span> <span class="mi">63</span> <span class="mi">6</span><span class="no">F</span> <span class="mi">6</span><span class="no">D</span> <span class="mi">70</span> <span class="mi">72</span> <span class="mi">65</span><span class="err">+</span>                                        <span class="c">; DATA XREF: seg000:0104↑o
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">01</span><span class="no">BF</span> <span class="mi">0</span><span class="no">D</span>                                      <span class="no">db</span>  <span class="mi">0</span><span class="no">Dh</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">C0</span> <span class="mi">0</span><span class="no">A</span>                                      <span class="no">db</span>  <span class="mi">0</span><span class="no">Ah</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">C1</span> <span class="mi">50</span>                                      <span class="no">db</span>  <span class="mi">50</span><span class="no">h</span> <span class="c">; P
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">01</span><span class="no">C2</span> <span class="mi">72</span> <span class="mi">65</span> <span class="mi">73</span> <span class="mi">73</span> <span class="mi">20</span> <span class="mi">43</span> <span class="mi">74</span> <span class="mi">72</span><span class="err">+</span><span class="no">aRessCtrlAltDel</span> <span class="no">db</span> <span class="err">&#39;</span><span class="no">ress</span> <span class="no">Ctrl</span><span class="err">+</span><span class="no">Alt</span><span class="err">+</span><span class="no">Del</span> <span class="no">to</span> <span class="no">restart</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">0</span><span class="no">Dh</span><span class="p">,</span><span class="mi">0</span><span class="no">Ah</span><span class="p">,</span><span class="mi">0</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">E1</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span><span class="err">+</span>                <span class="no">db</span> <span class="mi">15</span><span class="no">h</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">F6</span> <span class="mi">8</span><span class="no">A</span> <span class="mi">01</span>                   <span class="no">word_1F6</span>        <span class="no">dw</span> <span class="mi">18</span><span class="no">Ah</span>                 <span class="c">; DATA XREF: sub_11D:loc_16A↑r
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">01</span><span class="no">F8</span> <span class="no">A7</span>                                      <span class="no">db</span> <span class="mi">0</span><span class="no">A7h</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">F9</span> <span class="mi">01</span>                                      <span class="no">db</span> <span class="mi">1</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">FA</span> <span class="no">BF</span> <span class="mi">01</span>                   <span class="no">word_1FA</span>        <span class="no">dw</span> <span class="mi">1</span><span class="no">BFh</span>                 <span class="c">; DATA XREF: sub_11D+53↑r
</span><span class="c"></span><span class="no">seg000</span><span class="p">:</span><span class="mi">01</span><span class="no">FC</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">55</span> <span class="no">AA</span>                             <span class="no">db</span> <span class="mi">2</span> <span class="no">dup</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">55</span><span class="no">h</span><span class="p">,</span> <span class="mi">0</span><span class="no">AAh</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">FC</span>                         <span class="no">seg000</span>          <span class="no">ends</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">FC</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">FC</span>
<span class="nl">seg000:</span><span class="err">01</span><span class="nf">FC</span>                                         <span class="no">end</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="mbrvbr-bochs-动态调试">MBR/VBR Bochs 动态调试</h3>
<p>我这里使用了Bochs+IDA的方式，安装Bochs Windows版，Bochsrc内容如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">megs: 256
romimage:file=&#34;..\BIOS-bochs-latest&#34;
vgaromimage:file=&#34;..\VGABIOS-lgpl-latest&#34;
ata0-master: type=disk, path=&#34;..\c.img&#34;, mode=flat, cylinders=20, heads=16, spt=63
boot: disk
</code></pre></td></tr></table>
</div>
</div><p>镜像制作过程，利用Bochs自带的bximage制作即可，选择1，然后一路回车即可。<br>
<a href="/images/assets/post6/hximage.png" rel=""><img src="/images/assets/post6/hximage.png" width="100%"/></a><br>
之后用二进制编辑器如010editor，讲自己系统硬盘的MBR/VBR代码拷贝到制作好的img镜像即可，拷贝的地址偏移均不变。
IDA中在主菜单中debugger选项，选择本地bochs调试，选择上面新建好的Bochsrc文件即可。<br>
可能会遇到cfg文件报错，只需要在IDA文件夹下的cfg/dbg_bochs.cfg中编辑BOCHSDBG的路径即可。</p>
<h3 id="总结">总结</h3>
<p>综上结果，可以简单总结一下windows引导过程：</p>
<ul>
<li>
<p>加载MBR，MBR将自己备份到0x600H处，并更改IP为61CH开始执行代码</p>
</li>
<li>
<p>循环4次，在分区表中通过匹配活动分区标志，找到活动分区</p>
</li>
<li>
<p>通过int13中断，从0x800扇区处，读取一个扇区的代码大小，也就是读取512bytes的VBR，写入0x7C00H处</p>
</li>
<li>
<p>做一些端口读取和写入检测，然后代码进入VBR执行，MBR执行过程中，每次涉及到检测，只要错误，就会通过INT10打印错误信息，并停止运行代码</p>
</li>
<li>
<p>VBR代码执行，JMP跳转，并关闭中断，调整段寄存器</p>
</li>
<li>
<p>验证OEMID是否为NTFS</p>
</li>
<li>
<p>通过读取BPB结构体中HiddeSectors字段，加1得到IPL代码所在的扇区数，并读取0x2000个字节的IPL代码</p>
</li>
<li>
<p>跳转到IPL代码处，控制权交给IPL，开始后续的加载Bootmgr的过程</p>
</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-11-05</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://jhinxs.com/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90/" data-title="Windows BIOS MBR引导分析" data-via="realDonaldTrump" data-hashtags="Kernel,OS"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://jhinxs.com/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90/" data-hashtag="Kernel"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://jhinxs.com/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90/" data-title="Windows BIOS MBR引导分析"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://jhinxs.com/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90/" data-title="Windows BIOS MBR引导分析"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://jhinxs.com/windows-bios-mbr%E5%BC%95%E5%AF%BC%E5%88%86%E6%9E%90/" data-title="Windows BIOS MBR引导分析"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/kernel/">Kernel</a>,&nbsp;<a href="/tags/os/">OS</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/ollvm-windows%E4%B8%8B%E7%BC%96%E8%AF%91%E5%8F%8Avs%E9%9B%86%E6%88%90/" class="prev" rel="prev" title="Ollvm Windows下编译及VS集成"><i class="fas fa-angle-left fa-fw"></i>Ollvm Windows下编译及VS集成</a>
            <a href="/%E5%AE%89%E5%85%A8%E6%9E%B6%E6%9E%84-%E9%9B%B6%E4%BF%A1%E4%BB%BB%E5%88%9D%E8%AF%86/" class="next" rel="next" title="安全架构-零信任初识">安全架构-零信任初识<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">jhinxs</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">Jhinxs Story</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
